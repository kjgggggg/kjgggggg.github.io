<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"kjgggggg.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":false,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"./public/public/search.xml"};
  </script>

  <meta name="description" content="毕设素材">
<meta property="og:type" content="article">
<meta property="og:title" content="毕设">
<meta property="og:url" content="https://kjgggggg.github.io/2023/09/22/%E6%AF%95%E8%AE%BE/index.html">
<meta property="og:site_name" content="kjg&#39;s blog">
<meta property="og:description" content="毕设素材">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-09-22T11:14:33.000Z">
<meta property="article:modified_time" content="2024-01-18T06:55:03.482Z">
<meta property="article:author" content="kjg">
<meta property="article:tag" content="毕设">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://kjgggggg.github.io/2023/09/22/%E6%AF%95%E8%AE%BE/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>毕设 | kjg's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">kjg's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kjgggggg.github.io/2023/09/22/%E6%AF%95%E8%AE%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/WechatIMG84.jpeg">
      <meta itemprop="name" content="kjg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kjg's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          毕设
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-22 19:14:33" itemprop="dateCreated datePublished" datetime="2023-09-22T19:14:33+08:00">2023-09-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-01-18 14:55:03" itemprop="dateModified" datetime="2024-01-18T14:55:03+08:00">2024-01-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%AF%95%E8%AE%BE/" itemprop="url" rel="index"><span itemprop="name">毕设</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <div class="post-description">毕设素材</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="🪐-关注列表"><a href="#🪐-关注列表" class="headerlink" title="🪐 关注列表"></a>🪐 关注列表</h3><p>平台币：BGB GT OKB KCS </p>
<h3 id="🌟-专有名词"><a href="#🌟-专有名词" class="headerlink" title="🌟 专有名词"></a>🌟 专有名词</h3><ul>
<li><p>潜在上行比率</p>
<p>潜在上行比率越高，说明投资组合在市场上涨时的表现越好</p>
</li>
<li><p>夏普率</p>
<p>是一种衡量投资组合风险调整收益的指标。它将投资组合的超额收益与其波动性进行比较，以评估投资组合的风险调整收益水平。夏普率越高，说明投资组合在承担单位风险的情况下获得的超额收益越高</p>
</li>
<li><p>索提诺比率</p>
<p>是一种衡量投资组合下行风险调整收益的指标。它将投资组合的超额收益与其下行风险进行比较，以评估投资组合在负向波动中的表现。索提诺比率越高，说明投资组合在承担下行风险的情况下获得的超额收益越高</p>
</li>
<li><p>卡尔马比率</p>
<p>它将投资组合的年化收益率与最大回撤（即投资组合净值从峰值下跌到谷底的最大百分比）进行比较。卡尔马比率越高，说明投资组合在承担风险的情况下获得的年化收益越高。</p>
</li>
<li><p>斯特林比率</p>
<p>它将投资组合的年化收益率与下行风险（即投资组合净值下跌的时间和幅度）进行比较。斯特林比率越高，说明投资组合在承担下行风险的情况下获得的年化收益越高</p>
</li>
<li><p>遗传算法</p>
<p>是一种搜索和优化算法，它的灵感来源于自然界的生物进化过程，例如遗传、突变、自然选择和交叉等。遗传算法常常被用于解决优化和搜索问题。基本步骤如下：</p>
<ol>
<li>初始化：首先，算法会随机生成一个种群。种群中的每一个个体都是问题可能的解。</li>
<li>适应度函数：每个个体都会被评估并赋予一个适应度值，这个值表示该个体的质量或适应度。适应度越高，个体越有可能被选中进行繁殖。</li>
<li>选择：根据每个个体的适应度值进行选择。适应度高的个体有更高的机会被选中。</li>
<li>交叉：选中的个体会进行交叉操作，生成新的个体。这个过程模拟了生物的繁殖过程。</li>
<li>突变：新生成的个体有一定的机会发生突变，这可以引入新的特性。</li>
<li>新一代：新生成的个体会替换掉旧的个体，形成新的种群。</li>
<li>重复：算法会重复进行选择、交叉、突变的过程，直到满足终止条件，例如达到预设的迭代次数或者找到满意的解。</li>
</ol>
<p>遗传算法的主要优点是可以在大规模和复杂的搜索空间中找到好的解，而且不需要任何问题特定的知识。它的缺点是可能会陷入局部最优解，而不是全局最优解，而且对于参数的选择（如交叉率和突变率）非常敏感。</p>
</li>
<li></li>
</ul>
<h3 id="🌟-TradingView"><a href="#🌟-TradingView" class="headerlink" title="🌟 TradingView"></a>🌟 TradingView</h3><h4 id="脚本素材"><a href="#脚本素材" class="headerlink" title="脚本素材"></a>脚本素材</h4><h5 id="移动止盈"><a href="#移动止盈" class="headerlink" title="移动止盈"></a>移动止盈</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">strategy</span>(<span class="string">&quot;TrailingTakeProfit example&quot;</span>, overlay=<span class="literal">true</span>, margin_long=<span class="number">100</span>, margin_short=<span class="number">100</span>, default_qty_value = <span class="number">1</span>, initial_capital = <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">longCondition = ta.<span class="built_in">crossover</span>(ta.<span class="built_in">sma</span>(close, <span class="number">14</span>), ta.<span class="built_in">sma</span>(close, <span class="number">28</span>))</span><br><span class="line">shortCondition = ta.<span class="built_in">crossunder</span>(ta.<span class="built_in">sma</span>(close, <span class="number">14</span>), ta.<span class="built_in">sma</span>(close, <span class="number">28</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> longCondition</span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Long&quot;</span>, strategy.<span class="type">long</span>, comment=<span class="string">&quot;long&quot;</span>, alert_message=<span class="string">&quot;long&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> shortCondition</span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Short&quot;</span>, strategy.<span class="type">short</span>, comment=<span class="string">&quot;short&quot;</span>, alert_message=<span class="string">&quot;short&quot;</span>)</span><br><span class="line"></span><br><span class="line">atr_length=input.<span class="built_in">int</span>(<span class="number">7</span>, title=<span class="string">&quot;ATR Length&quot;</span>)</span><br><span class="line">atr_multiplier = input.<span class="built_in">float</span>(<span class="number">1.5</span>, title=<span class="string">&quot;ATR Multiplier&quot;</span>)</span><br><span class="line">atr_multiplied = atr_multiplier * ta.<span class="built_in">atr</span>(atr_length)</span><br><span class="line">ttp_top_bracket = strategy.position_size&gt;<span class="number">0</span> ? high[<span class="number">1</span>]+atr_multiplied : na</span><br><span class="line">ttp_bottom_bracket = strategy.position_size&lt;<span class="number">0</span> ? low[<span class="number">1</span>]-atr_multiplied : na</span><br><span class="line"></span><br><span class="line"><span class="built_in">plot</span>(ttp_top_bracket, title=<span class="string">&quot;ttp_top_bracket&quot;</span>, color=color.lime, style=plot.style_linebr, offset=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">plot</span>(ttp_bottom_bracket, title=<span class="string">&quot;ttp_bottom_bracket&quot;</span>, color=color.red, style=plot.style_linebr, offset=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">strategy.<span class="built_in">exit</span>(<span class="string">&quot;closelong&quot;</span>, from_entry=<span class="string">&quot;Long&quot;</span>, limit=ttp_top_bracket, alert_message = <span class="string">&quot;closelong&quot;</span>)</span><br><span class="line">strategy.<span class="built_in">exit</span>(<span class="string">&quot;closeshort&quot;</span>, from_entry=<span class="string">&quot;Short&quot;</span>, limit=ttp_bottom_bracket, alert_message = <span class="string">&quot;closeshort&quot;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="箱体突破"><a href="#箱体突破" class="headerlink" title="箱体突破"></a>箱体突破</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/</span></span><br><span class="line"><span class="comment">// © Uncle-Gua</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//本策略可以不用分段止盈，ETH 1h下，纯粹的BULL开多，BEAR开空就可以实现年化100%以上的盈利。</span></span><br><span class="line"><span class="comment">//但是分段止盈，可以降低风险，同时在大趋势时trail模式下，能多吃很多利润</span></span><br><span class="line"><span class="comment">//在一个多头周期内，止盈位置不同，可能会影响下一次开仓位置，使用仓位控制判断的。可以参照v5 indicator，每一个绿色三角都可能开多，红色都可能开空。</span></span><br><span class="line"><span class="comment">//本策略是趋势策略，会不停追，那么就有时候会地板空（高点多），试过RSI等很多指标避免，效果都不是很好。</span></span><br><span class="line"><span class="comment">//释怀了之后就可以认为震荡赚不到钱，无所谓了，大趋势时候会顶着背离冲，多赚很多。震荡时可以人工干预一点。</span></span><br><span class="line"><span class="comment">//@version=5</span></span><br><span class="line"><span class="built_in">strategy</span>(title=<span class="string">&#x27;Box Scalper v4 long only&#x27;</span>, overlay=<span class="literal">true</span>, initial_capital=<span class="number">1000</span>, default_qty_type=strategy.cash, default_qty_value=<span class="number">1000</span>, commission_type=strategy.commission.percent, commission_value=<span class="number">0.05</span>,use_bar_magnifier=<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">start           = input.<span class="built_in">time</span>(<span class="built_in">timestamp</span>(<span class="string">&#x27;2020-01-01T00:00:00&#x27;</span>), group=<span class="string">&#x27;Back Test&#x27;</span>, title=<span class="string">&#x27;Start&#x27;</span>)</span><br><span class="line">finish          = input.<span class="built_in">time</span>(<span class="built_in">timestamp</span>(<span class="string">&#x27;2030-12-31T00:00:00&#x27;</span>), group=<span class="string">&#x27;Back Test&#x27;</span>, title=<span class="string">&#x27;Finish&#x27;</span>)</span><br><span class="line">window          = time &gt;= start <span class="keyword">and</span> time &lt;= finish ? <span class="literal">true</span> : <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// *                                    Functions                              *</span></span><br><span class="line"><span class="comment">// *                                   Box Scalper                             *</span></span><br><span class="line"><span class="comment">// *                              @Author : Uncle-Gua                          *</span></span><br><span class="line"><span class="comment">// *                                                                           *</span></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// -------------|---------------------------|---------------------------|-------------------|---------------|</span></span><br><span class="line"><span class="comment">// 因为所有函数使用都没有跨周期，所以没有做无重绘处理。</span></span><br><span class="line"><span class="built_in">fn_zigzag</span>(_momentum_direction) =&gt;</span><br><span class="line">    zz_goingup = _momentum_direction == <span class="number">1</span></span><br><span class="line">    zz_goingdown = _momentum_direction == <span class="number">-1</span></span><br><span class="line">    zz_peak = <span class="built_in">float</span>(na)</span><br><span class="line">    zz_bottom = <span class="built_in">float</span>(na)</span><br><span class="line">    zz_peak := high &gt; zz_peak[<span class="number">1</span>] <span class="keyword">and</span> zz_goingup <span class="keyword">or</span> zz_goingdown[<span class="number">1</span>] ? high : <span class="built_in">nz</span>(zz_peak[<span class="number">1</span>])</span><br><span class="line">    zz_bottom := low &lt; zz_bottom[<span class="number">1</span>] <span class="keyword">and</span> zz_goingdown <span class="keyword">or</span> zz_goingup[<span class="number">1</span>] ? low : <span class="built_in">nz</span>(zz_bottom[<span class="number">1</span>])</span><br><span class="line">    zigzag = zz_goingup <span class="keyword">and</span> zz_goingdown[<span class="number">1</span>] ? zz_bottom[<span class="number">1</span>] : zz_goingup[<span class="number">1</span>] <span class="keyword">and</span> zz_goingdown ? zz_peak[<span class="number">1</span>] : na</span><br><span class="line">    zigzag</span><br><span class="line"></span><br><span class="line"><span class="built_in">fn_rsi</span>(src, len, mtf)=&gt;</span><br><span class="line">    change = src - src[mtf]</span><br><span class="line"></span><br><span class="line">    up = math.<span class="built_in">max</span>(change, <span class="number">0</span>)</span><br><span class="line">    dn =-math.<span class="built_in">min</span>(change, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    up_change = ta.<span class="built_in">rma</span>(up, (len * mtf))</span><br><span class="line">    dn_change = ta.<span class="built_in">rma</span>(dn, (len * mtf))</span><br><span class="line">    </span><br><span class="line">    rsi = dn_change == <span class="number">0</span> ? <span class="number">100</span> : up_change == <span class="number">0</span> ? <span class="number">0</span> : <span class="number">100</span> - (<span class="number">100</span> / (<span class="number">1</span> + up_change / dn_change))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 14, 5, 8, 4.3</span></span><br><span class="line"><span class="built_in">fn_qqe</span>(len, mtf, smooth, mult)=&gt;</span><br><span class="line">    wilders =  len * <span class="number">2</span> - <span class="number">1</span> </span><br><span class="line"></span><br><span class="line">    up = <span class="number">0.0</span></span><br><span class="line">    up_rsi = <span class="built_in">fn_rsi</span>(low, len, mtf)</span><br><span class="line">    up_ema = ta.<span class="built_in">ema</span>(up_rsi, smooth)</span><br><span class="line">    up_atr = math.<span class="built_in">abs</span>(up_ema[<span class="number">1</span>] - up_ema)</span><br><span class="line">    up_diff = ta.<span class="built_in">ema</span>(ta.<span class="built_in">ema</span>(up_atr, wilders), wilders) * mult</span><br><span class="line">    up_ma = up_ema - up_diff</span><br><span class="line">    up := up_ema[<span class="number">1</span>] &gt; up[<span class="number">1</span>] <span class="keyword">and</span> up_ema &gt; up[<span class="number">1</span>] ? math.<span class="built_in">max</span>(up_ma, up[<span class="number">1</span>]) : up_ma</span><br><span class="line"></span><br><span class="line">    dn = <span class="number">0.0</span></span><br><span class="line">    dn_rsi = <span class="built_in">fn_rsi</span>(high, len, mtf)</span><br><span class="line">    dn_ema = ta.<span class="built_in">ema</span>(dn_rsi, smooth)</span><br><span class="line">    dn_atr = math.<span class="built_in">abs</span>(dn_ema[<span class="number">1</span>] - dn_ema)</span><br><span class="line">    dn_diff = ta.<span class="built_in">ema</span>(ta.<span class="built_in">ema</span>(dn_atr, wilders), wilders) * mult</span><br><span class="line">    dn_ma = dn_ema + dn_diff</span><br><span class="line">    dn := dn_ema[<span class="number">1</span>] &lt; dn[<span class="number">1</span>] <span class="keyword">and</span> dn_ema &lt; dn[<span class="number">1</span>] ? math.<span class="built_in">min</span>(dn_ma, dn[<span class="number">1</span>]) : dn_ma</span><br><span class="line">    </span><br><span class="line">    qqe_up = dn_ema &gt; dn[<span class="number">1</span>] <span class="keyword">and</span> dn_ema[<span class="number">1</span>] &lt;= dn[<span class="number">2</span>] <span class="comment">//ta.crossover(dn_ema, dn[1])</span></span><br><span class="line">    qqe_dn = up_ema &lt; up[<span class="number">1</span>] <span class="keyword">and</span> up_ema[<span class="number">1</span>] &gt;= up[<span class="number">2</span>] <span class="comment">//ta.crossunder(up_ema, up[1])</span></span><br><span class="line">    [qqe_up, qqe_dn]</span><br><span class="line"></span><br><span class="line"><span class="built_in">fn_adx</span>(len, smooth) =&gt;</span><br><span class="line">    up      =  ta.<span class="built_in">change</span>(high)</span><br><span class="line">    dn      = -ta.<span class="built_in">change</span>(low)</span><br><span class="line">    pdm     = <span class="built_in">na</span>(up) ? na : up &gt; dn <span class="keyword">and</span> up &gt; <span class="number">0</span> ? up : <span class="number">0</span></span><br><span class="line">    mdm     = <span class="built_in">na</span>(dn) ? na : dn &gt; up <span class="keyword">and</span> dn &gt; <span class="number">0</span> ? dn : <span class="number">0</span></span><br><span class="line">    atr     = ta.<span class="built_in">atr</span>(len)</span><br><span class="line">    plus    = <span class="built_in">fixnan</span>(<span class="number">100</span> * ta.<span class="built_in">rma</span>(pdm, len) / atr)</span><br><span class="line">    minus   = <span class="built_in">fixnan</span>(<span class="number">100</span> * ta.<span class="built_in">rma</span>(mdm, len) / atr)</span><br><span class="line">    sum     = plus + minus</span><br><span class="line">    adx     = <span class="number">100</span> * ta.<span class="built_in">rma</span>(math.<span class="built_in">abs</span>(plus - minus) / (sum == <span class="number">0</span> ? <span class="number">1</span> : sum), smooth)</span><br><span class="line">    [plus, minus, adx]</span><br><span class="line"></span><br><span class="line"><span class="built_in">fn_covwma</span>(a, b) =&gt;</span><br><span class="line">    cov    = ta.<span class="built_in">stdev</span>(a, b)/ta.<span class="built_in">sma</span>(a, b)</span><br><span class="line">    cw     = a*cov</span><br><span class="line">    covwma = math.<span class="built_in">sum</span>(cw, b)/math.<span class="built_in">sum</span>(cov, b)</span><br><span class="line"></span><br><span class="line"><span class="built_in">fn_ssl</span>(length) =&gt;</span><br><span class="line">    hh = ta.<span class="built_in">hma</span>(high, length)</span><br><span class="line">    ll = ta.<span class="built_in">hma</span>(low, length)</span><br><span class="line"></span><br><span class="line">    hlv = <span class="built_in">int</span>(na)</span><br><span class="line">    hlv := close &gt; hh ? <span class="number">1</span> : close &lt; ll ? <span class="number">-1</span> : hlv[<span class="number">1</span>]</span><br><span class="line">    ssl = hlv &lt; <span class="number">0</span> ? hh : ll</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// *                                      ADX                                  *</span></span><br><span class="line"><span class="comment">// *                                   Box Scalper                             *</span></span><br><span class="line"><span class="comment">// *                              @Author : Uncle-Gua                          *</span></span><br><span class="line"><span class="comment">// *                                                                           *</span></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// -------------|---------------------------|---------------------------|-------------------|---------------|</span></span><br><span class="line">ADX_Group       = <span class="string">&#x27;ADX&#x27;</span></span><br><span class="line">ADX_Length      = input.<span class="built_in">int</span>(<span class="number">14</span>,             title=<span class="string">&#x27;Length&#x27;</span>,             group=ADX_Group,    minval=<span class="number">1</span>,       step=<span class="number">1</span>)</span><br><span class="line">ADX_Smooth      = input.<span class="built_in">int</span>(<span class="number">14</span>,             title=<span class="string">&#x27;Smooth&#x27;</span>,             group=ADX_Group,    minval=<span class="number">1</span>,       step=<span class="number">1</span>)</span><br><span class="line">ADX_Range       = input.<span class="built_in">float</span>(<span class="number">25</span>,           title=<span class="string">&#x27;Range&#x27;</span>,              group=ADX_Group,    minval=<span class="number">1</span>,       step=<span class="number">1</span>)</span><br><span class="line">ADX_Trend       = input.<span class="built_in">float</span>(<span class="number">50</span>,           title=<span class="string">&#x27;Trend&#x27;</span>,              group=ADX_Group,    minval=<span class="number">1</span>,       step=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ADX指标一般是用于趋势和震荡的判断</span></span><br><span class="line"><span class="comment">// 一般ADX &gt; 50认为是大趋势，小于25是震荡。</span></span><br><span class="line"><span class="comment">// +DI &gt; -DI是上涨，否则是下跌</span></span><br><span class="line">[ADX_plus, ADX_minus, ADX] = <span class="built_in">fn_adx</span>(ADX_Length, ADX_Smooth)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// *                                      SSL                                  *</span></span><br><span class="line"><span class="comment">// *                                   Box Scalper                             *</span></span><br><span class="line"><span class="comment">// *                              @Author : Uncle-Gua                          *</span></span><br><span class="line"><span class="comment">// *                                                                           *</span></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// -------------|---------------------------|---------------------------|-------------------|---------------|</span></span><br><span class="line">SSL_Group       = <span class="string">&#x27;SSL&#x27;</span></span><br><span class="line">SSL_Length      = input.<span class="built_in">int</span>(<span class="number">55</span>,             title=<span class="string">&#x27;Length&#x27;</span>,             group=SSL_Group,    minval=<span class="number">1</span>,       step=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// SSL核心是HMA，这是均线指标，入场非常准，但是出场迟缓</span></span><br><span class="line">SSL = <span class="built_in">fn_ssl</span>(SSL_Length)</span><br><span class="line"></span><br><span class="line">SSL_color = close &gt; SSL ? #<span class="number">00</span>c3ff : close &lt; SSL ? #ff0062 : na</span><br><span class="line"><span class="built_in">plot</span>(SSL, title=<span class="string">&#x27;SSL&#x27;</span>, linewidth=<span class="number">3</span>, color=SSL_color)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// *                                   Squeeze Box                             *</span></span><br><span class="line"><span class="comment">// *                                   Box Scalper                             *</span></span><br><span class="line"><span class="comment">// *                              @Author : Uncle-Gua                          *</span></span><br><span class="line"><span class="comment">// *                                                                           *</span></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// -------------|---------------------------|---------------------------|-------------------|---------------|</span></span><br><span class="line">BOX_Group       = <span class="string">&#x27;Squeeze Box&#x27;</span></span><br><span class="line">BOX_Period      = input.<span class="built_in">int</span>(<span class="number">24</span>,             title=<span class="string">&#x27;Periods&#x27;</span>,            group=BOX_Group,    minval=<span class="number">1</span>,       step=<span class="number">1</span>)</span><br><span class="line">BOX_Deviation   = input.<span class="built_in">int</span>(<span class="number">3</span>,              title=<span class="string">&#x27;Deviation&#x27;</span>,          group=BOX_Group,    minval=<span class="number">1</span>,       step=<span class="number">1</span>)</span><br><span class="line">BOX_Threshold   = input.<span class="built_in">int</span>(<span class="number">50</span>,             title=<span class="string">&#x27;Threshold&#x27;</span>,          group=BOX_Group,    minval=<span class="number">1</span>,       step=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过挤压方式计算箱体</span></span><br><span class="line"><span class="comment">// 理论上，在没有外界干扰情况下，价格应该实在箱体内部震荡，一旦突破箱体，会急速拉升或下跌</span></span><br><span class="line">BOX_src = hlc3</span><br><span class="line">BOX_ma = <span class="built_in">fn_covwma</span>(BOX_src, BOX_Period)</span><br><span class="line">BOX_bu = BOX_ma + ta.<span class="built_in">stdev</span>(BOX_src, BOX_Period)*BOX_Deviation</span><br><span class="line">BOX_bd = BOX_ma - ta.<span class="built_in">stdev</span>(BOX_src, BOX_Period)*BOX_Deviation</span><br><span class="line"></span><br><span class="line"><span class="comment">//Bandwidth</span></span><br><span class="line">BOX_bw = (BOX_bu - BOX_bd)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Squeeze Percentage</span></span><br><span class="line">BOX_buh = ta.<span class="built_in">highest</span>(BOX_bu, BOX_Period)</span><br><span class="line">BOX_bdl = ta.<span class="built_in">lowest</span>(BOX_bd, BOX_Period)</span><br><span class="line">BOX_rng = BOX_buh - BOX_bdl</span><br><span class="line">BOX_sqp = <span class="number">100</span>*BOX_bw/BOX_rng</span><br><span class="line"></span><br><span class="line"><span class="comment">//Squeeze Box</span></span><br><span class="line">BOX_sqz  = (BOX_sqp &lt; BOX_Threshold) ? <span class="number">1</span> : <span class="number">0</span></span><br><span class="line">BOX_hh   = ta.<span class="built_in">highest</span>(BOX_src, BOX_Period)</span><br><span class="line">BOX_boxh = BOX_sqz ? BOX_hh : BOX_src</span><br><span class="line">BOX_ll   = ta.<span class="built_in">lowest</span>(BOX_src, BOX_Period)</span><br><span class="line">BOX_boxl = BOX_sqz ? BOX_ll : BOX_src</span><br><span class="line">BOX_bh   = ta.<span class="built_in">valuewhen</span>(BOX_sqz, BOX_boxh, <span class="number">1</span>)</span><br><span class="line">BOX_bl   = ta.<span class="built_in">valuewhen</span>(BOX_sqz, BOX_boxl, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Colors</span></span><br><span class="line">boxcolor = BOX_src &gt; BOX_bh ? color.lime : BOX_src &lt; BOX_bl ? color.red : color.orange</span><br><span class="line">bhcolor  = BOX_sqz ? boxcolor : na</span><br><span class="line">blcolor  = BOX_sqz ? boxcolor : na</span><br><span class="line"></span><br><span class="line">bhplot = <span class="built_in">plot</span>(BOX_bh, color=color.<span class="built_in">new</span>(boxcolor, <span class="number">50</span>), title=<span class="string">&quot;Box High Level&quot;</span>)</span><br><span class="line">blplot = <span class="built_in">plot</span>(BOX_bl, color=color.<span class="built_in">new</span>(boxcolor, <span class="number">50</span>), title=<span class="string">&quot;Box Low Level&quot;</span>)</span><br><span class="line"><span class="built_in">fill</span>(bhplot, blplot, color=color.<span class="built_in">new</span>(boxcolor, <span class="number">87</span>), title=<span class="string">&quot;Box Fill&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// *                                      QQE                                  *</span></span><br><span class="line"><span class="comment">// *                                   Box Scalper                             *</span></span><br><span class="line"><span class="comment">// *                              @Author : Uncle-Gua                          *</span></span><br><span class="line"><span class="comment">// *                                                                           *</span></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// -------------|---------------------------|---------------------------|-------------------|---------------|</span></span><br><span class="line">QQE_Group       = <span class="string">&#x27;QQE&#x27;</span></span><br><span class="line">QQE_Length      = input.<span class="built_in">int</span>(<span class="number">14</span>,             title=<span class="string">&#x27;RSI Length&#x27;</span>,         group=QQE_Group,    minval=<span class="number">1</span>,       step=<span class="number">1</span>)</span><br><span class="line">QQE_Mtf         = input.<span class="built_in">int</span>(<span class="number">5</span>,              title=<span class="string">&#x27;MTF Mult&#x27;</span>,           group=QQE_Group,    minval=<span class="number">1</span>,       step=<span class="number">1</span>)</span><br><span class="line">QQE_Smooth      = input.<span class="built_in">int</span>(<span class="number">8</span>,              title=<span class="string">&#x27;RSI Smooth&#x27;</span>,         group=QQE_Group,    minval=<span class="number">1</span>,       step=<span class="number">1</span>)</span><br><span class="line">QQE_Mult        = input.<span class="built_in">float</span>(<span class="number">4.3</span>,          title=<span class="string">&#x27;QQE Mult&#x27;</span>,           group=QQE_Group,    minval=<span class="number">1</span>,       step=<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算QQE，以便后面ZIGZAG使用</span></span><br><span class="line">[QQE_up, QQE_dn] = <span class="built_in">fn_qqe</span>(QQE_Length, QQE_Mtf, QQE_Smooth, QQE_Mult)</span><br><span class="line"></span><br><span class="line">QQE_direction = <span class="number">0</span></span><br><span class="line">QQE_direction := QQE_up ? <span class="number">1</span> : QQE_dn ? <span class="number">-1</span> : <span class="built_in">nz</span>(QQE_direction[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// *                                    QQE ZONE                               *</span></span><br><span class="line"><span class="comment">// *                                   Box Scalper                             *</span></span><br><span class="line"><span class="comment">// *                              @Author : Uncle-Gua                          *</span></span><br><span class="line"><span class="comment">// *                                                                           *</span></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// -------------|---------------------------|---------------------------|-------------------|---------------|</span></span><br><span class="line">ZON_Group       = <span class="string">&#x27;QQE ZONE&#x27;</span></span><br><span class="line">ZON_Length      = input.<span class="built_in">int</span>(<span class="number">5</span>,              title=<span class="string">&#x27;Length&#x27;</span>,             group=ZON_Group,    minval=<span class="number">1</span>,       step=<span class="number">1</span>)</span><br><span class="line">ZON_Upper       = input.<span class="built_in">float</span>(<span class="number">75</span>,           title=<span class="string">&#x27;Upper&#x27;</span>,              group=ZON_Group,    minval=<span class="number">50</span>,      maxval=<span class="number">100</span>,     step=<span class="number">1</span>)</span><br><span class="line">ZON_Lower       = input.<span class="built_in">float</span>(<span class="number">22</span>,           title=<span class="string">&#x27;Lower&#x27;</span>,              group=ZON_Group,    minval=<span class="number">0</span>,       maxval=<span class="number">50</span>,      step=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里主要计算是否是force的下跌还是下降</span></span><br><span class="line">qqe_rsi = ta.<span class="built_in">rsi</span>(close, ZON_Length)</span><br><span class="line">barssince_qqe_up = ta.<span class="built_in">barssince</span>(QQE_up)</span><br><span class="line">barssince_qqe_dn = ta.<span class="built_in">barssince</span>(QQE_dn)</span><br><span class="line">barssince_rsi_up = ta.<span class="built_in">barssince</span>(qqe_rsi &gt; ZON_Upper)</span><br><span class="line">barssince_rsi_dn = ta.<span class="built_in">barssince</span>(qqe_rsi &lt; ZON_Lower)</span><br><span class="line">qqe_was_force_up = QQE_dn <span class="keyword">and</span> barssince_qqe_up[<span class="number">1</span>] &gt;= barssince_rsi_up[<span class="number">1</span>]</span><br><span class="line">qqe_was_force_dn = QQE_up <span class="keyword">and</span> barssince_qqe_dn[<span class="number">1</span>] &gt;= barssince_rsi_dn[<span class="number">1</span>]</span><br><span class="line">zzcolor = qqe_was_force_up ? color.lime : qqe_was_force_dn ? color.red : color.black</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对QQE Direction做zigzag，也就是高低点。入场比较迟缓。</span></span><br><span class="line">ZigZag = <span class="built_in">fn_zigzag</span>(QQE_direction)</span><br><span class="line"><span class="built_in">plot</span>(ZigZag, linewidth=<span class="number">2</span>, color=zzcolor, title=<span class="string">&#x27;ZigZag&#x27;</span>, style=plot.style_line)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// *                                       Box                                 *</span></span><br><span class="line"><span class="comment">// *                                   Box Scalper                             *</span></span><br><span class="line"><span class="comment">// *                              @Author : Uncle-Gua                          *</span></span><br><span class="line"><span class="comment">// *                                                                           *</span></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// -------------|---------------------------|---------------------------|-------------------|---------------|</span></span><br><span class="line">var <span class="type">float</span> zz_top = high</span><br><span class="line">var <span class="type">float</span> zz_bot = low</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据zigzag计算支撑和阻力位置</span></span><br><span class="line">ph = ta.<span class="built_in">valuewhen</span>(QQE_dn, ZigZag, <span class="number">0</span>)</span><br><span class="line">pl = ta.<span class="built_in">valuewhen</span>(QQE_up, ZigZag, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> QQE_dn</span><br><span class="line">    zz_top := <span class="built_in">nz</span>(high &gt; ph ? high : ph, zz_top[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">if</span> QQE_up</span><br><span class="line">    zz_bot := <span class="built_in">nz</span>(low &lt; pl ? low : pl, zz_bot[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">plot</span>(zz_top, color=color.aqua, style=plot.style_cross, title=<span class="string">&#x27;Resistance&#x27;</span>)</span><br><span class="line"><span class="built_in">plot</span>(zz_bot, color=color.yellow, style=plot.style_cross, title=<span class="string">&#x27;Support&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// *                                Position Setting                           *</span></span><br><span class="line"><span class="comment">// *                                  Box Scalper                              *</span></span><br><span class="line"><span class="comment">// *                              @Author : Uncle-Gua                          *</span></span><br><span class="line"><span class="comment">// *                                                                           *</span></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// -------------|---------------------------|---------------------------|-------------------|---------------|</span></span><br><span class="line">PS_Group        = <span class="string">&#x27;POSITION&#x27;</span></span><br><span class="line">PS_Expect       = input.<span class="built_in">string</span>(<span class="string">&#x27;BOTH&#x27;</span>,      title=<span class="string">&#x27;Expect&#x27;</span>,             group=PS_Group,     options=[<span class="string">&#x27;BOTH&#x27;</span>,<span class="string">&#x27;LONG&#x27;</span>, <span class="string">&#x27;SHORT&#x27;</span>]) <span class="comment">// 默认是双向持仓，可以锁仓</span></span><br><span class="line">PS_Mode         = input.<span class="built_in">string</span>(<span class="string">&#x27;Capital&#x27;</span>,   title=<span class="string">&#x27;Mode&#x27;</span>,               group=PS_Group,     options=[<span class="string">&#x27;Capital&#x27;</span>, <span class="string">&#x27;Equity&#x27;</span>])    <span class="comment">// 仓位模式是全仓还是滚仓</span></span><br><span class="line">PS_Initial      = input.<span class="built_in">int</span>(<span class="number">100</span>,            title=<span class="string">&#x27;Initial(%)&#x27;</span>,         group=PS_Group,     minval=<span class="number">1</span>,       maxval=<span class="number">100</span>)       <span class="comment">// 初始仓位是initial_capital的百分比</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// *                                  Stop Loss                                *</span></span><br><span class="line"><span class="comment">// *                                Super Scalper                              *</span></span><br><span class="line"><span class="comment">// *                              @Author : Uncle-Gua                          *</span></span><br><span class="line"><span class="comment">// *                                                                           *</span></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// -------------|---------------------------|---------------------------|-------------------|---------------|</span></span><br><span class="line">TSL_Group       = <span class="string">&#x27;Stop Loss&#x27;</span></span><br><span class="line">TSL_SL1         = input.<span class="built_in">float</span>(<span class="number">3.1</span>,          title=<span class="string">&#x27;Stop Loss Min(%)&#x27;</span>,   group=TSL_Group,    minval=<span class="number">0</span>,       step=<span class="number">0.1</span>) <span class="comment">// 止损的最小值，因为我们的止损是自动计算的，一般认为，当市场没有流动性时，止损太小会频繁止损。</span></span><br><span class="line">TSL_SL2         = input.<span class="built_in">float</span>(<span class="number">9.9</span>,          title=<span class="string">&#x27;Stop Loss Max(%)&#x27;</span>,   group=TSL_Group,    minval=<span class="number">0</span>,       step=<span class="number">0.1</span>) <span class="comment">// 硬止损，如果达到这个值，什么都不考虑，直接平仓，预防黑天鹅。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// *                                  Take Profit                              *</span></span><br><span class="line"><span class="comment">// *                                  Box Scalper                              *</span></span><br><span class="line"><span class="comment">// *                              @Author : Uncle-Gua                          *</span></span><br><span class="line"><span class="comment">// *                                                                           *</span></span><br><span class="line"><span class="comment">// *****************************************************************************</span></span><br><span class="line"><span class="comment">// -------------|---------------------------|---------------------------|-------------------|---------------|</span></span><br><span class="line">TP_Group        = <span class="string">&#x27;Take Profit&#x27;</span></span><br><span class="line"><span class="comment">//止盈模式，追踪止盈还是固定止盈。如果是固定，当达到止盈目标时，直接止盈。trail模式下，当达到止盈并不立即执行，而是等到最高点回调Trail Offset才去止盈。大趋势有利，震荡有弊。</span></span><br><span class="line">TP_Mode         = input.<span class="built_in">string</span>(<span class="string">&#x27;Trail&#x27;</span>,     title=<span class="string">&#x27;Mode&#x27;</span>,               group=TP_Group,     options=[<span class="string">&#x27;Trail&#x27;</span>, <span class="string">&#x27;Fixed&#x27;</span>])</span><br><span class="line">TP_Ts1          = input.<span class="built_in">float</span>(<span class="number">2.1</span>,          title=<span class="string">&#x27;Profit Target 1(%)&#x27;</span>, group=TP_Group,     minval=<span class="number">0</span>,       step=<span class="number">0.1</span>)  <span class="comment">//止盈的最小值</span></span><br><span class="line">TP_Ts2          = input.<span class="built_in">float</span>(<span class="number">1.0</span>,          title=<span class="string">&#x27;Profit Target 2(%)&#x27;</span>, group=TP_Group,     minval=<span class="number">0</span>,       step=<span class="number">0.1</span>)  <span class="comment">//止盈的最大值</span></span><br><span class="line">TP_To           = input.<span class="built_in">float</span>(<span class="number">0.1</span>,          title=<span class="string">&#x27;Trail Offset(%)&#x27;</span>,    group=TP_Group,     minval=<span class="number">0</span>,       step=<span class="number">0.1</span>)  <span class="comment">//追踪止盈的幅度</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//这里是把百分比全部转换成点数</span></span><br><span class="line">PIP_ts1         = close * TP_Ts1 / syminfo.mintick / <span class="number">100</span></span><br><span class="line">PIP_ts2         = close * TP_Ts2 / syminfo.mintick / <span class="number">100</span></span><br><span class="line">PIP_to          = close * TP_To / syminfo.mintick / <span class="number">100</span></span><br><span class="line">PIP_tp1         = TP_Mode == <span class="string">&#x27;Trail&#x27;</span> ? na : PIP_ts1 <span class="comment">//这里是代表当在trail时，值是na，那么就会启用追踪。当时固定止盈时，其值等于追踪的开始值，因为到了这个值就止盈了，所以追踪就没用了。</span></span><br><span class="line">PIP_tp2         = TP_Mode == <span class="string">&#x27;Trail&#x27;</span> ? na : PIP_ts2</span><br><span class="line"></span><br><span class="line">TICKER = syminfo.prefix + <span class="string">&#x27;:&#x27;</span> + syminfo.ticker</span><br><span class="line"></span><br><span class="line"><span class="built_in">plot</span>(strategy.position_avg_price, linewidth=<span class="number">2</span>, color=color.white, style=plot.style_linebr, title=<span class="string">&#x27;Average Price&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//入场条件：均线QQE和FORCE，周末不出趋势不乱开单，回穿箱体</span></span><br><span class="line">week = dayofweek</span><br><span class="line">BULL = (close &gt; SSL <span class="keyword">and</span> QQE_up <span class="keyword">and</span> <span class="keyword">not</span> qqe_was_force_dn <span class="built_in">and</span> (week != <span class="number">7</span> <span class="keyword">and</span> week != <span class="number">1</span> <span class="keyword">or</span> ADX &gt; ADX_Trend)) <span class="built_in">or</span> (close &gt; SSL <span class="keyword">and</span> ta.<span class="built_in">crossover</span>(close, BOX_bl))</span><br><span class="line">BEAR = (close &lt; SSL <span class="keyword">and</span> QQE_dn <span class="keyword">and</span> <span class="keyword">not</span> qqe_was_force_up <span class="built_in">and</span> (week != <span class="number">7</span> <span class="keyword">and</span> week != <span class="number">1</span> <span class="keyword">or</span> ADX &gt; ADX_Trend)) <span class="built_in">or</span> (close &lt; SSL <span class="keyword">and</span> ta.<span class="built_in">crossunder</span>(close, BOX_bh))</span><br><span class="line"></span><br><span class="line"><span class="comment">//sign是符号，1或-1，ROE是盈利百分比（你仓位10倍杠杆，那还要*10，但是我们仅仅计算1倍）。 **但是代码中写了好像没啥用</span></span><br><span class="line">sign = strategy.position_size &gt; <span class="number">0</span> ? <span class="number">1</span> : strategy.position_size &lt; <span class="number">0</span> ? <span class="number">-1</span> : na</span><br><span class="line">ROE = sign * (close - strategy.position_avg_price) / strategy.position_avg_price * <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 出现开空信号，在锁多模式下，立刻平仓</span></span><br><span class="line"><span class="keyword">if</span> strategy.position_size &gt; <span class="number">0</span> <span class="keyword">and</span> PS_Expect == <span class="string">&#x27;LONG&#x27;</span> <span class="keyword">and</span> BEAR</span><br><span class="line">    SIZE = str.<span class="built_in">tostring</span>(math.<span class="built_in">abs</span>(strategy.position_size))</span><br><span class="line">    cl_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;LONG&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;CL-L&quot;&#125;&#x27;</span></span><br><span class="line">    strategy.<span class="built_in">close</span>(<span class="string">&#x27;LONG&#x27;</span>, comment=<span class="string">&#x27;CL-L&#x27;</span>, alert_message=cl_msg)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 出现开空信号，在锁空模式下，立刻平仓</span></span><br><span class="line"><span class="keyword">if</span> strategy.position_size &lt; <span class="number">0</span> <span class="keyword">and</span> PS_Expect == <span class="string">&#x27;SHORT&#x27;</span> <span class="keyword">and</span> BULL</span><br><span class="line">    SIZE = str.<span class="built_in">tostring</span>(math.<span class="built_in">abs</span>(strategy.position_size))</span><br><span class="line">    cl_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;SHORT&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;CL-S&quot;&#125;&#x27;</span></span><br><span class="line">    strategy.<span class="built_in">close</span>(<span class="string">&#x27;SHORT&#x27;</span>, comment=<span class="string">&#x27;CL-S&#x27;</span>, alert_message=cl_msg)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 持有多头时，根据ADX重新设置止盈。</span></span><br><span class="line"><span class="comment">// 根据支撑阻力重设止损</span></span><br><span class="line"><span class="comment">// ******每根K线都重新设置*********</span></span><br><span class="line"><span class="keyword">if</span> strategy.position_size &gt; <span class="number">0</span></span><br><span class="line">    redline1 = strategy.position_avg_price * (<span class="number">100</span> - TSL_SL1) / <span class="number">100</span></span><br><span class="line">    redline2 = strategy.position_avg_price * (<span class="number">100</span> - TSL_SL2) / <span class="number">100</span></span><br><span class="line">    stoploss = math.<span class="built_in">max</span>(math.<span class="built_in">min</span>(zz_bot, redline1), redline2)</span><br><span class="line">    SIZE = str.<span class="built_in">tostring</span>(math.<span class="built_in">abs</span>(strategy.position_size))</span><br><span class="line">    PIP_tp = ADX &gt; ADX_Range <span class="keyword">and</span> ADX_plus &gt; ADX_minus <span class="keyword">and</span> ADX &gt; ADX[<span class="number">1</span>] <span class="keyword">and</span> ADX &lt; ADX_Trend ? PIP_tp1 : PIP_tp2</span><br><span class="line">    PIP_ts = ADX &gt; ADX_Range <span class="keyword">and</span> ADX_plus &gt; ADX_minus <span class="keyword">and</span> ADX &gt; ADX[<span class="number">1</span>] <span class="keyword">and</span> ADX &lt; ADX_Trend ? PIP_ts1 : PIP_ts2</span><br><span class="line">    tp_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;LONG&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;TP-L&quot;&#125;&#x27;</span></span><br><span class="line">    sl_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;LONG&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;SL-L&quot;&#125;&#x27;</span></span><br><span class="line">    tr_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;LONG&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;TR-L&quot;&#125;&#x27;</span></span><br><span class="line">    strategy.<span class="built_in">exit</span>(<span class="string">&#x27;CL-L&#x27;</span>, <span class="string">&#x27;LONG&#x27;</span>, comment_profit=<span class="string">&#x27;TP-L&#x27;</span>, comment_loss=<span class="string">&#x27;SL-L&#x27;</span>, comment_trailing=<span class="string">&#x27;TR-L&#x27;</span>, stop=stoploss, profit=PIP_tp, trail_points=PIP_ts, trail_offset=PIP_to, alert_profit=tp_msg, alert_loss=sl_msg, alert_trailing=tr_msg)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 持有空头时，根据ADX重新设置止盈。</span></span><br><span class="line"><span class="comment">// 根据支撑阻力重设止损</span></span><br><span class="line"><span class="comment">// ******每根K线都重新设置**********</span></span><br><span class="line"><span class="keyword">if</span> strategy.position_size &lt; <span class="number">0</span></span><br><span class="line">    redline1 = strategy.position_avg_price * (<span class="number">100</span> + TSL_SL1) / <span class="number">100</span></span><br><span class="line">    redline2 = strategy.position_avg_price * (<span class="number">100</span> + TSL_SL2) / <span class="number">100</span></span><br><span class="line">    stoploss = math.<span class="built_in">min</span>(math.<span class="built_in">max</span>(zz_top, redline1), redline2)</span><br><span class="line">    SIZE = str.<span class="built_in">tostring</span>(math.<span class="built_in">abs</span>(strategy.position_size))</span><br><span class="line">    PIP_tp = ADX &gt; ADX_Range <span class="keyword">and</span> ADX_plus &lt; ADX_minus <span class="keyword">and</span> ADX &gt; ADX[<span class="number">1</span>] <span class="keyword">and</span> ADX &lt; ADX_Trend ? PIP_tp1 : PIP_tp2</span><br><span class="line">    PIP_ts = ADX &gt; ADX_Range <span class="keyword">and</span> ADX_plus &lt; ADX_minus <span class="keyword">and</span> ADX &gt; ADX[<span class="number">1</span>] <span class="keyword">and</span> ADX &lt; ADX_Trend ? PIP_ts1 : PIP_ts2</span><br><span class="line">    tp_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;SHORT&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;TP-S&quot;&#125;&#x27;</span></span><br><span class="line">    sl_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;SHORT&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;SL-S&quot;&#125;&#x27;</span></span><br><span class="line">    tr_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;SHORT&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;TR-S&quot;&#125;&#x27;</span></span><br><span class="line">    strategy.<span class="built_in">exit</span>(<span class="string">&#x27;CL-S&#x27;</span>, <span class="string">&#x27;SHORT&#x27;</span>, comment_profit=<span class="string">&#x27;TP-S&#x27;</span>, comment_loss=<span class="string">&#x27;SL-S&#x27;</span>, comment_trailing=<span class="string">&#x27;TR-S&#x27;</span>, stop=stoploss, profit=PIP_tp, trail_points=PIP_ts, trail_offset=PIP_to, alert_profit=tp_msg, alert_loss=sl_msg, alert_trailing=tr_msg)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开多</span></span><br><span class="line"><span class="comment">// 止盈按最大的值设置</span></span><br><span class="line"><span class="comment">// 有时候大趋势下，刚开单，一根K线就砸了2.1%，这个就吃到了。</span></span><br><span class="line"><span class="keyword">if</span> window <span class="keyword">and</span> strategy.position_size &lt;= <span class="number">0</span> <span class="keyword">and</span> PS_Expect != <span class="string">&#x27;SHORT&#x27;</span> <span class="keyword">and</span> BULL</span><br><span class="line">    size = (PS_Mode == <span class="string">&#x27;Capital&#x27;</span> ? strategy.initial_capital : strategy.equity) / close * (PS_Initial / <span class="number">100</span>)</span><br><span class="line">    SIZE = str.<span class="built_in">tostring</span>(size)</span><br><span class="line">    op_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;OPEN&quot;,&quot;side&quot;:&quot;LONG&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;OP-L@&#x27;</span> + str.<span class="built_in">tostring</span>(close, format.mintick) + <span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&#x27;LONG&#x27;</span>, strategy.<span class="type">long</span>, qty=size, comment=<span class="string">&#x27;OP-L@&#x27;</span> + str.<span class="built_in">tostring</span>(close, format.mintick), alert_message=op_msg)</span><br><span class="line">    redline1 = close * (<span class="number">100</span> - TSL_SL1) / <span class="number">100</span></span><br><span class="line">    redline2 = close * (<span class="number">100</span> - TSL_SL2) / <span class="number">100</span></span><br><span class="line">    stoploss = math.<span class="built_in">max</span>(math.<span class="built_in">min</span>(zz_bot, redline1), redline2) <span class="comment">//止损按支撑线，最小值，最大值计算</span></span><br><span class="line">    tp_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;LONG&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;TP-L&quot;&#125;&#x27;</span></span><br><span class="line">    sl_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;LONG&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;SL-L&quot;&#125;&#x27;</span></span><br><span class="line">    tr_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;LONG&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;TR-L&quot;&#125;&#x27;</span></span><br><span class="line">    strategy.<span class="built_in">exit</span>(<span class="string">&#x27;CL-L&#x27;</span>, <span class="string">&#x27;LONG&#x27;</span>, comment_profit=<span class="string">&#x27;TP-L&#x27;</span>, comment_loss=<span class="string">&#x27;SL-L&#x27;</span>, comment_trailing=<span class="string">&#x27;TR-L&#x27;</span>, stop=stoploss, profit=PIP_tp1, trail_points=PIP_ts1, trail_offset=PIP_to, alert_profit=tp_msg, alert_loss=sl_msg, alert_trailing=tr_msg)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开空</span></span><br><span class="line"><span class="comment">// 止盈按最大的值设置</span></span><br><span class="line"><span class="comment">// 有时候大趋势下，刚开单，一根K线就砸了2.1%，这个就吃到了。</span></span><br><span class="line"><span class="keyword">if</span> window <span class="keyword">and</span> strategy.position_size &gt;= <span class="number">0</span> <span class="keyword">and</span> PS_Expect != <span class="string">&#x27;LONG&#x27;</span> <span class="keyword">and</span> BEAR</span><br><span class="line">    size = (PS_Mode == <span class="string">&#x27;Capital&#x27;</span> ? strategy.initial_capital : strategy.equity) / close * (PS_Initial / <span class="number">100</span>)</span><br><span class="line">    SIZE = str.<span class="built_in">tostring</span>(size)</span><br><span class="line">    op_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;OPEN&quot;,&quot;side&quot;:&quot;SHORT&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;OP-S@&#x27;</span> + str.<span class="built_in">tostring</span>(close, format.mintick) + <span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&#x27;SHORT&#x27;</span>, strategy.<span class="type">short</span>, qty=size, comment=<span class="string">&#x27;OP-S@&#x27;</span> + str.<span class="built_in">tostring</span>(close, format.mintick), alert_message=op_msg)</span><br><span class="line">    redline1 = close * (<span class="number">100</span> + TSL_SL1) / <span class="number">100</span></span><br><span class="line">    redline2 = close * (<span class="number">100</span> + TSL_SL2) / <span class="number">100</span></span><br><span class="line">    stoploss = math.<span class="built_in">min</span>(math.<span class="built_in">max</span>(zz_top, redline1), redline2) <span class="comment">//止损按支撑线，最小值，最大值计算</span></span><br><span class="line">    tp_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;SHORT&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;TP-S&quot;&#125;&#x27;</span></span><br><span class="line">    sl_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;SHORT&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;SL-S&quot;&#125;&#x27;</span></span><br><span class="line">    tr_msg = <span class="string">&#x27;&#123;&quot;symbol&quot;:&quot;&#x27;</span>+TICKER+<span class="string">&#x27;&quot;,&quot;action&quot;:&quot;CLOSE&quot;,&quot;side&quot;:&quot;SHORT&quot;,&quot;size&quot;:&#x27;</span> + SIZE + <span class="string">&#x27;,&quot;comment&quot;:&quot;TR-S&quot;&#125;&#x27;</span></span><br><span class="line">    strategy.<span class="built_in">exit</span>(<span class="string">&#x27;CL-S&#x27;</span>, <span class="string">&#x27;SHORT&#x27;</span>, comment_profit=<span class="string">&#x27;TP-S&#x27;</span>, comment_loss=<span class="string">&#x27;SL-S&#x27;</span>, comment_trailing=<span class="string">&#x27;TR-S&#x27;</span>, stop=stoploss, profit=PIP_tp1, trail_points=PIP_ts1, trail_offset=PIP_to, alert_profit=tp_msg, alert_loss=sl_msg, alert_trailing=tr_msg)</span><br></pre></td></tr></table></figure>

<h5 id="马丁"><a href="#马丁" class="headerlink" title="马丁"></a>马丁</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//@version=5</span></span><br><span class="line"><span class="built_in">strategy</span>(<span class="string">&#x27;升级版的马丁 -- DCA&#x27;</span>, shorttitle=<span class="string">&quot;升级版的马丁 -- DCA&quot;</span>, overlay=<span class="literal">true</span>, precision=<span class="number">2</span>, pyramiding=<span class="number">51</span>, </span><br><span class="line"> calc_on_every_tick=<span class="literal">true</span>, backtest_fill_limits_assumption=<span class="number">1</span>, default_qty_type=strategy.fixed, currency=currency.USD, slippage=<span class="number">1</span>, commission_type=strategy.commission.percent,</span><br><span class="line"> commission_value=<span class="number">.05</span>, process_orders_on_close=<span class="literal">true</span>, initial_capital=<span class="number">1000</span>, margin_long=<span class="number">100</span>, margin_short=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Choose Strategy</span></span><br><span class="line">strategy = input.<span class="built_in">string</span>(<span class="string">&quot;MACD&quot;</span>, title=<span class="string">&quot;Buy Signal Strategy&quot;</span>, options=[<span class="string">&quot;MFI&quot;</span>, <span class="string">&quot;RSI&quot;</span>, <span class="string">&quot;MACD&quot;</span>, <span class="string">&quot;Stochastic RSI&quot;</span>], tooltip=<span class="string">&quot;This is your buy signal strategy. MACD triggers a buy signal when the MACD signal line crosses above the MACD line. MFI triggers a buy signal when MFI is below your threshold level in the next setting. RSI triggers a buy signal when RSI is below your threshold level in the next setting. Stochastic RSI triggers a buy signal when the K line crosses above the D line.&quot;</span>, group=<span class="string">&quot;Strategy&quot;</span>)</span><br><span class="line">strategyLevelTrigger = input.<span class="built_in">int</span>(<span class="number">20</span>, title=<span class="string">&quot;Signal Threshold Level&quot;</span>, tooltip=<span class="string">&quot;This number is the threshold that MFI or RSI will need to be below to trigger a buy signal. So if you set it to 20, the MFI or RSI that you chose above will trigger a buy signal when it goes below this number. This setting has no affect on the MACD or Stochastic RSI even when a value is set.&quot;</span>, group=<span class="string">&quot;Strategy&quot;</span>)</span><br><span class="line">strategyLength = input.<span class="built_in">int</span>(<span class="number">14</span>, title=<span class="string">&quot;Indicator Length&quot;</span>, tooltip=<span class="string">&quot;This is the length used for RSI and MFI. MACD uses the standard 12, 26, 9 lengths and Stochastic RSI uses 3, 3, 14, 14 lengths. MACD and Stochastic RSI will not be affected by this input number.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Inputs</span></span><br><span class="line">stoplossOn = input.<span class="built_in">bool</span>(<span class="literal">false</span>, title=<span class="string">&quot;Stoploss On&quot;</span>, group=<span class="string">&quot;DCA Bot Settings&quot;</span>)</span><br><span class="line">stoploss = input.<span class="built_in">float</span>(<span class="number">5</span>, title=<span class="string">&quot;Stoploss %&quot;</span>, minval=<span class="number">.0001</span>, step=<span class="number">.001</span>, group=<span class="string">&quot;DCA Bot Settings&quot;</span>)/<span class="number">100</span></span><br><span class="line">takeProfit = input.<span class="built_in">float</span>(<span class="number">.5</span>, title=<span class="string">&quot;Take Profit %&quot;</span>, minval=<span class="number">.0001</span>, step=<span class="number">.001</span>, group=<span class="string">&quot;DCA Bot Settings&quot;</span>)/<span class="number">100</span></span><br><span class="line">avgDown = input.<span class="built_in">float</span>(<span class="number">.5</span>, title=<span class="string">&quot;Average Down %&quot;</span>, minval=<span class="number">.0001</span>, step=<span class="number">.001</span>, group=<span class="string">&quot;DCA Bot Settings&quot;</span>)/<span class="number">100</span></span><br><span class="line">percentScale = input.<span class="built_in">float</span>(<span class="number">1.2</span>, title=<span class="string">&quot;Avg Down % Multiplier&quot;</span>, minval=<span class="number">.0001</span>, step=<span class="number">.001</span>, group=<span class="string">&quot;DCA Bot Settings&quot;</span>)</span><br><span class="line">multiplier = input.<span class="built_in">float</span>(<span class="number">1.5</span>, title=<span class="string">&quot;Volume Multiplier&quot;</span>, minval=<span class="number">1</span>, step=<span class="number">.001</span>, tooltip=<span class="string">&quot;Increasing this value above 1 will multiply each new orders volume by the amount you input. This makes your buys bigger every time you average down so you don&#x27;t need as big of a bounce when it recovers to get out in profit.&quot;</span>, group=<span class="string">&quot;DCA Bot Settings&quot;</span>)</span><br><span class="line">maxOrders = input.<span class="built_in">int</span>(<span class="number">12</span>, title=<span class="string">&quot;Max # Of Orders&quot;</span>, group=<span class="string">&quot;DCA Bot Settings&quot;</span>)</span><br><span class="line">quantity = input.<span class="built_in">float</span>(<span class="number">100</span>, title=<span class="string">&quot;Size Of Base Order&quot;</span>, minval=<span class="number">.000000001</span>, step=<span class="number">.000000001</span>, group=<span class="string">&quot;DCA Bot Settings&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Info Table On/Off</span></span><br><span class="line">dataTableOn = input.<span class="built_in">bool</span>(<span class="literal">true</span>, title=<span class="string">&quot;Info Table On/Off&quot;</span>, group=<span class="string">&quot;Info Tables&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Average Down Levels On/Off</span></span><br><span class="line">orderLevelsOn = input.<span class="built_in">bool</span>(<span class="literal">true</span>, title=<span class="string">&quot;Turn Average Down Levels On/Off&quot;</span>, group=<span class="string">&quot;Average Down Levels&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Table Positions</span></span><br><span class="line">bright = position.bottom_right</span><br><span class="line">bleft = position.bottom_left</span><br><span class="line">bcenter = position.bottom_center</span><br><span class="line">tright = position.top_right</span><br><span class="line">tleft = position.top_left</span><br><span class="line">tcenter = position.top_center</span><br><span class="line">mright = position.middle_right</span><br><span class="line">mleft = position.middle_left</span><br><span class="line">mcenter = position.middle_center</span><br><span class="line">tablePosition = input.<span class="built_in">string</span>(bright, title=<span class="string">&quot;Percentage Table Position&quot;</span>, options=[bright, bleft, bcenter, tright, tleft, tcenter, mright, mleft, mcenter], group=<span class="string">&quot;Info Tables&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Buy Signals</span></span><br><span class="line">buy = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//MACD</span></span><br><span class="line">fastMa = ta.<span class="built_in">sma</span>(close, <span class="number">12</span>)</span><br><span class="line">slowMa = ta.<span class="built_in">sma</span>(close, <span class="number">26</span>)</span><br><span class="line">macd = fastMa - slowMa</span><br><span class="line">signal = ta.<span class="built_in">sma</span>(macd, <span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>  strategy == <span class="string">&quot;MACD&quot;</span> <span class="keyword">and</span> ta.<span class="built_in">crossover</span>(macd, signal)</span><br><span class="line">    buy := <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//MFI</span></span><br><span class="line">mfi = ta.<span class="built_in">mfi</span>(close, strategyLength)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy == <span class="string">&quot;MFI&quot;</span> <span class="keyword">and</span> mfi &lt;= strategyLevelTrigger</span><br><span class="line">    buy := <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//RSI</span></span><br><span class="line">rsi = ta.<span class="built_in">rsi</span>(close, strategyLength)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy == <span class="string">&quot;RSI&quot;</span> <span class="keyword">and</span> rsi &lt;= strategyLevelTrigger</span><br><span class="line">    buy := <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Stochastic RSI</span></span><br><span class="line">smoothK = <span class="number">3</span></span><br><span class="line">smoothD = <span class="number">3</span></span><br><span class="line">lengthRSI = <span class="number">14</span></span><br><span class="line">lengthStoch = <span class="number">14</span></span><br><span class="line">rsi1 = ta.<span class="built_in">rsi</span>(close, lengthRSI)</span><br><span class="line">k = ta.<span class="built_in">sma</span>(ta.<span class="built_in">stoch</span>(rsi1, rsi1, rsi1, lengthStoch), smoothK)</span><br><span class="line">d = ta.<span class="built_in">sma</span>(k, smoothD)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>  strategy == <span class="string">&quot;Stochastic RSI&quot;</span> <span class="keyword">and</span> ta.<span class="built_in">crossover</span>(k, d)</span><br><span class="line">    buy := <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Alerts</span></span><br><span class="line"><span class="keyword">if</span> buy</span><br><span class="line">    <span class="built_in">alert</span>(<span class="string">&quot;Place Open Deal Code From 3Commas Here.&quot;</span>, alert.freq_once_per_bar_close)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Order Quantity Adjustments With Volume Multiplier</span></span><br><span class="line">quantityConverted = quantity/close</span><br><span class="line">quantMultiplied1 = quantityConverted * multiplier</span><br><span class="line">quantMultiplied2 = quantMultiplied1 * multiplier</span><br><span class="line">quantMultiplied3 = quantMultiplied2 * multiplier</span><br><span class="line">quantMultiplied4 = quantMultiplied3 * multiplier</span><br><span class="line">quantMultiplied5 = quantMultiplied4 * multiplier</span><br><span class="line">quantMultiplied6 = quantMultiplied5 * multiplier</span><br><span class="line">quantMultiplied7 = quantMultiplied6 * multiplier</span><br><span class="line">quantMultiplied8 = quantMultiplied7 * multiplier</span><br><span class="line">quantMultiplied9 = quantMultiplied8 * multiplier</span><br><span class="line">quantMultiplied10 = quantMultiplied9 * multiplier</span><br><span class="line">quantMultiplied11 = quantMultiplied10 * multiplier</span><br><span class="line">quantMultiplied12 = quantMultiplied11 * multiplier</span><br><span class="line">quantMultiplied13 = quantMultiplied12 * multiplier</span><br><span class="line">quantMultiplied14 = quantMultiplied13 * multiplier</span><br><span class="line">quantMultiplied15 = quantMultiplied14 * multiplier</span><br><span class="line">quantMultiplied16 = quantMultiplied15 * multiplier</span><br><span class="line">quantMultiplied17 = quantMultiplied16 * multiplier</span><br><span class="line">quantMultiplied18 = quantMultiplied17 * multiplier</span><br><span class="line">quantMultiplied19 = quantMultiplied18 * multiplier</span><br><span class="line">quantMultiplied20 = quantMultiplied19 * multiplier</span><br><span class="line">quantMultiplied21 = quantMultiplied20 * multiplier</span><br><span class="line">quantMultiplied22 = quantMultiplied21 * multiplier</span><br><span class="line">quantMultiplied23 = quantMultiplied22 * multiplier</span><br><span class="line">quantMultiplied24 = quantMultiplied23 * multiplier</span><br><span class="line">quantMultiplied25 = quantMultiplied24 * multiplier</span><br><span class="line">quantMultiplied26 = quantMultiplied25 * multiplier</span><br><span class="line">quantMultiplied27 = quantMultiplied26 * multiplier</span><br><span class="line">quantMultiplied28 = quantMultiplied27 * multiplier</span><br><span class="line">quantMultiplied29 = quantMultiplied28 * multiplier</span><br><span class="line">quantMultiplied30 = quantMultiplied29 * multiplier</span><br><span class="line">quantMultiplied31 = quantMultiplied30 * multiplier</span><br><span class="line">quantMultiplied32 = quantMultiplied31 * multiplier</span><br><span class="line">quantMultiplied33 = quantMultiplied32 * multiplier</span><br><span class="line">quantMultiplied34 = quantMultiplied33 * multiplier</span><br><span class="line">quantMultiplied35 = quantMultiplied34 * multiplier</span><br><span class="line">quantMultiplied36 = quantMultiplied35 * multiplier</span><br><span class="line">quantMultiplied37 = quantMultiplied36 * multiplier</span><br><span class="line">quantMultiplied38 = quantMultiplied37 * multiplier</span><br><span class="line">quantMultiplied39 = quantMultiplied38 * multiplier</span><br><span class="line">quantMultiplied40 = quantMultiplied39 * multiplier</span><br><span class="line">quantMultiplied41 = quantMultiplied40 * multiplier</span><br><span class="line">quantMultiplied42 = quantMultiplied41 * multiplier</span><br><span class="line">quantMultiplied43 = quantMultiplied42 * multiplier</span><br><span class="line">quantMultiplied44 = quantMultiplied43 * multiplier</span><br><span class="line">quantMultiplied45 = quantMultiplied44 * multiplier</span><br><span class="line">quantMultiplied46 = quantMultiplied45 * multiplier</span><br><span class="line">quantMultiplied47 = quantMultiplied46 * multiplier</span><br><span class="line">quantMultiplied48 = quantMultiplied47 * multiplier</span><br><span class="line">quantMultiplied49 = quantMultiplied48 * multiplier</span><br><span class="line">quantMultiplied50 = quantMultiplied49 * multiplier</span><br><span class="line"></span><br><span class="line"><span class="comment">// Average Down Levels</span></span><br><span class="line">avgDown1 = (avgDown * percentScale) + avgDown</span><br><span class="line">avgDown2 = (avgDown1 * percentScale) + avgDown</span><br><span class="line">avgDown3 = (avgDown2 * percentScale) + avgDown</span><br><span class="line">avgDown4 = (avgDown3 * percentScale) + avgDown</span><br><span class="line">avgDown5 = (avgDown4 * percentScale) + avgDown</span><br><span class="line">avgDown6 = (avgDown5 * percentScale) + avgDown</span><br><span class="line">avgDown7 = (avgDown6 * percentScale) + avgDown</span><br><span class="line">avgDown8 = (avgDown7 * percentScale) + avgDown</span><br><span class="line">avgDown9 = (avgDown8 * percentScale) + avgDown</span><br><span class="line">avgDown10 = (avgDown9 * percentScale) + avgDown</span><br><span class="line">avgDown11 = (avgDown10 * percentScale) + avgDown</span><br><span class="line">avgDown12 = (avgDown11 * percentScale) + avgDown</span><br><span class="line">avgDown13 = (avgDown12 * percentScale) + avgDown</span><br><span class="line">avgDown14 = (avgDown13 * percentScale) + avgDown</span><br><span class="line">avgDown15 = (avgDown14 * percentScale) + avgDown</span><br><span class="line">avgDown16 = (avgDown15 * percentScale) + avgDown</span><br><span class="line">avgDown17 = (avgDown16 * percentScale) + avgDown</span><br><span class="line">avgDown18 = (avgDown17 * percentScale) + avgDown</span><br><span class="line">avgDown19 = (avgDown18 * percentScale) + avgDown</span><br><span class="line">avgDown20 = (avgDown19 * percentScale) + avgDown</span><br><span class="line">avgDown21 = (avgDown20 * percentScale) + avgDown</span><br><span class="line">avgDown22 = (avgDown21 * percentScale) + avgDown</span><br><span class="line">avgDown23 = (avgDown22 * percentScale) + avgDown</span><br><span class="line">avgDown24 = (avgDown23 * percentScale) + avgDown</span><br><span class="line">avgDown25 = (avgDown24 * percentScale) + avgDown</span><br><span class="line">avgDown26 = (avgDown25 * percentScale) + avgDown</span><br><span class="line">avgDown27 = (avgDown26 * percentScale) + avgDown</span><br><span class="line">avgDown28 = (avgDown27 * percentScale) + avgDown</span><br><span class="line">avgDown29 = (avgDown28 * percentScale) + avgDown</span><br><span class="line">avgDown30 = (avgDown29 * percentScale) + avgDown</span><br><span class="line">avgDown31 = (avgDown30 * percentScale) + avgDown</span><br><span class="line">avgDown32 = (avgDown31 * percentScale) + avgDown</span><br><span class="line">avgDown33 = (avgDown32 * percentScale) + avgDown</span><br><span class="line">avgDown34 = (avgDown33 * percentScale) + avgDown</span><br><span class="line">avgDown35 = (avgDown34 * percentScale) + avgDown</span><br><span class="line">avgDown36 = (avgDown35 * percentScale) + avgDown</span><br><span class="line">avgDown37 = (avgDown36 * percentScale) + avgDown</span><br><span class="line">avgDown38 = (avgDown37 * percentScale) + avgDown</span><br><span class="line">avgDown39 = (avgDown38 * percentScale) + avgDown</span><br><span class="line">avgDown40 = (avgDown39 * percentScale) + avgDown</span><br><span class="line">avgDown41 = (avgDown40 * percentScale) + avgDown</span><br><span class="line">avgDown42 = (avgDown41 * percentScale) + avgDown</span><br><span class="line">avgDown43 = (avgDown42 * percentScale) + avgDown</span><br><span class="line">avgDown44 = (avgDown43 * percentScale) + avgDown</span><br><span class="line">avgDown45 = (avgDown44 * percentScale) + avgDown</span><br><span class="line">avgDown46 = (avgDown45 * percentScale) + avgDown</span><br><span class="line">avgDown47 = (avgDown46 * percentScale) + avgDown</span><br><span class="line">avgDown48 = (avgDown47 * percentScale) + avgDown</span><br><span class="line">avgDown49 = (avgDown48 * percentScale) + avgDown</span><br><span class="line">avgDown50 = (avgDown49 * percentScale) + avgDown</span><br><span class="line"></span><br><span class="line"><span class="comment">//Strategy Trade Signal</span></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">0</span> <span class="keyword">and</span> buy <span class="keyword">and</span> barstate.isconfirmed </span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&#x27;Bull #1&#x27;</span>, strategy.<span class="type">long</span>, qty=quantityConverted, comment=<span class="string">&#x27;Buy #1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Plot Entry &amp; Average Down Levels</span></span><br><span class="line"><span class="built_in">plot</span>(strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>), title=<span class="string">&quot;Order #1&quot;</span>, color=color.white)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">2</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown) : na, title=<span class="string">&quot;Order #2&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">3</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown1) : na, title=<span class="string">&quot;Order #3&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">4</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown2) : na, title=<span class="string">&quot;Order #4&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">5</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown3) : na, title=<span class="string">&quot;Order #5&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">6</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown4) : na, title=<span class="string">&quot;Order #6&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">7</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown5) : na, title=<span class="string">&quot;Order #7&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">8</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown6) : na, title=<span class="string">&quot;Order #8&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">9</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown7) : na, title=<span class="string">&quot;Order #9&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">10</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown8) : na, title=<span class="string">&quot;Order #10&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">11</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown9) : na, title=<span class="string">&quot;Order #11&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">12</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown10) : na, title=<span class="string">&quot;Order #12&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">13</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown11) : na, title=<span class="string">&quot;Order #13&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">14</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown12) : na, title=<span class="string">&quot;Order #14&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">15</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown13) : na, title=<span class="string">&quot;Order #15&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">16</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown14) : na, title=<span class="string">&quot;Order #16&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">17</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown15) : na, title=<span class="string">&quot;Order #17&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">18</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown16) : na, title=<span class="string">&quot;Order #18&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">19</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown17) : na, title=<span class="string">&quot;Order #19&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">20</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown18) : na, title=<span class="string">&quot;Order #20&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">21</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown19) : na, title=<span class="string">&quot;Order #21&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">22</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown20) : na, title=<span class="string">&quot;Order #22&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">23</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown21) : na, title=<span class="string">&quot;Order #23&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">24</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown22) : na, title=<span class="string">&quot;Order #24&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">25</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown23) : na, title=<span class="string">&quot;Order #25&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">26</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown24) : na, title=<span class="string">&quot;Order #26&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">27</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown25) : na, title=<span class="string">&quot;Order #27&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">28</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown26) : na, title=<span class="string">&quot;Order #28&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">29</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown27) : na, title=<span class="string">&quot;Order #29&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">30</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown28) : na, title=<span class="string">&quot;Order #30&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">31</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown29) : na, title=<span class="string">&quot;Order #31&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">32</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown30) : na, title=<span class="string">&quot;Order #32&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">33</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown31) : na, title=<span class="string">&quot;Order #33&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">34</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown32) : na, title=<span class="string">&quot;Order #34&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">35</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown33) : na, title=<span class="string">&quot;Order #35&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">36</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown34) : na, title=<span class="string">&quot;Order #36&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">37</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown35) : na, title=<span class="string">&quot;Order #37&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">38</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown36) : na, title=<span class="string">&quot;Order #38&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">39</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown37) : na, title=<span class="string">&quot;Order #39&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">40</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown38) : na, title=<span class="string">&quot;Order #40&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">41</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown39) : na, title=<span class="string">&quot;Order #41&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">42</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown40) : na, title=<span class="string">&quot;Order #42&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">43</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown41) : na, title=<span class="string">&quot;Order #43&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">44</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown42) : na, title=<span class="string">&quot;Order #44&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">45</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown43) : na, title=<span class="string">&quot;Order #45&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">46</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown44) : na, title=<span class="string">&quot;Order #46&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">47</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown45) : na, title=<span class="string">&quot;Order #47&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">48</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown46) : na, title=<span class="string">&quot;Order #48&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">49</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown47) : na, title=<span class="string">&quot;Order #49&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">50</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown48) : na, title=<span class="string">&quot;Order #50&quot;</span>, color=color.green)</span><br><span class="line"><span class="built_in">plot</span>(maxOrders &gt;= <span class="number">51</span> <span class="keyword">and</span> orderLevelsOn ? strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown49) : na, title=<span class="string">&quot;Order #51&quot;</span>, color=color.green)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">1</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">2</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&#x27;Bull #1&#x27;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied1, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown),</span><br><span class="line">     comment=<span class="string">&quot;Buy #2 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">2</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">3</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied2, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown1),</span><br><span class="line">     comment=<span class="string">&quot;Buy #3 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown1 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">3</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">4</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied3, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown2), </span><br><span class="line">     comment=<span class="string">&quot;Buy #4 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown2 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">4</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">5</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied4, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown3),</span><br><span class="line">     comment=<span class="string">&quot;Buy #5 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown3 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">5</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">6</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied5, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown4),</span><br><span class="line">     comment=<span class="string">&quot;Buy #6 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown4 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">6</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">7</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied6, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown5),</span><br><span class="line">     comment=<span class="string">&quot;Buy #7 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown5 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">7</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">8</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied7, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown6),</span><br><span class="line">     comment=<span class="string">&quot;Buy #8 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown6 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">8</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">9</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied8, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown7),</span><br><span class="line">     comment=<span class="string">&quot;Buy #9 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown7 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">9</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">10</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied9, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown8),</span><br><span class="line">     comment=<span class="string">&quot;Buy #10 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown8 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">10</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">11</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied10, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown9),</span><br><span class="line">     comment=<span class="string">&quot;Buy #11 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown9 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">11</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">12</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied11, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown10),</span><br><span class="line">     comment=<span class="string">&quot;Buy #12 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown10 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">12</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">13</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied12, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown11),</span><br><span class="line">     comment=<span class="string">&quot;Buy #13 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown11 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">13</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">14</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied13, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown12),</span><br><span class="line">     comment=<span class="string">&quot;Buy #14 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown12 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">14</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">15</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied14, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown13),</span><br><span class="line">     comment=<span class="string">&quot;Buy #15 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown13 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">15</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">16</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied15, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown14),</span><br><span class="line">     comment=<span class="string">&quot;Buy #16 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown14 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">16</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">17</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied16, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown15),</span><br><span class="line">     comment=<span class="string">&quot;Buy #17 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown15 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">17</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">18</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied17, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown16),</span><br><span class="line">     comment=<span class="string">&quot;Buy #18 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown16 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">18</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">19</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied18, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown17),</span><br><span class="line">     comment=<span class="string">&quot;Buy #19 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown17 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">19</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">20</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied19, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown18),</span><br><span class="line">     comment=<span class="string">&quot;Buy #20 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown18 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">20</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">21</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied20, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown19),</span><br><span class="line">     comment=<span class="string">&quot;Buy #21 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown19 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">21</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">22</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied21, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown20),</span><br><span class="line">     comment=<span class="string">&quot;Buy #22 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown20 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">22</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">23</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied21, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown21),</span><br><span class="line">     comment=<span class="string">&quot;Buy #23 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown21 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">23</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">24</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied22, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown22),</span><br><span class="line">     comment=<span class="string">&quot;Buy #24 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown22 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">24</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">25</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied23, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown23),</span><br><span class="line">     comment=<span class="string">&quot;Buy #25 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown23 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">25</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">26</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied24, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown24),</span><br><span class="line">     comment=<span class="string">&quot;Buy #26 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown24 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">26</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">27</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied25, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown25),</span><br><span class="line">     comment=<span class="string">&quot;Buy #27 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown25 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">27</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">28</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied26, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown26),</span><br><span class="line">     comment=<span class="string">&quot;Buy #28 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown26 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">28</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">29</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied27, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown27),</span><br><span class="line">     comment=<span class="string">&quot;Buy #29 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown27 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">29</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">30</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied28, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown28),</span><br><span class="line">     comment=<span class="string">&quot;Buy #30 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown28 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">30</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">31</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied29, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown29),</span><br><span class="line">     comment=<span class="string">&quot;Buy #31 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown29 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">31</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">32</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied30, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown30),</span><br><span class="line">     comment=<span class="string">&quot;Buy #32 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown30 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">32</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">33</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied31, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown31),</span><br><span class="line">     comment=<span class="string">&quot;Buy #33 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown31 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">33</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">34</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied32, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown32),</span><br><span class="line">     comment=<span class="string">&quot;Buy #34 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown32 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">34</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">35</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied33, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown33),</span><br><span class="line">     comment=<span class="string">&quot;Buy #35 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown33 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">35</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">36</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied34, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown34),</span><br><span class="line">     comment=<span class="string">&quot;Buy #36 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown34 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">36</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">37</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied35, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown35),</span><br><span class="line">     comment=<span class="string">&quot;Buy #37 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown35 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">37</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">38</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied36, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown36),</span><br><span class="line">     comment=<span class="string">&quot;Buy #38 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown36 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">38</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">39</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied37, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown37),</span><br><span class="line">     comment=<span class="string">&quot;Buy #39 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown37 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">39</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">40</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied38, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown38),</span><br><span class="line">     comment=<span class="string">&quot;Buy #40 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown38 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">40</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">41</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied39, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown39),</span><br><span class="line">     comment=<span class="string">&quot;Buy #41 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown39 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">41</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">42</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied40, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown40),</span><br><span class="line">     comment=<span class="string">&quot;Buy #42 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown40 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">42</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">43</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied41, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown41),</span><br><span class="line">     comment=<span class="string">&quot;Buy #43 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown41 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">43</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">44</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied42, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown42),</span><br><span class="line">     comment=<span class="string">&quot;Buy #44 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown42 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">44</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">45</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied43, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown43),</span><br><span class="line">     comment=<span class="string">&quot;Buy #45 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown43 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">45</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">46</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied44, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown44),</span><br><span class="line">     comment=<span class="string">&quot;Buy #46 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown44 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">46</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">47</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied45, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown45),</span><br><span class="line">     comment=<span class="string">&quot;Buy #47 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown45 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">47</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">48</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied46, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown46),</span><br><span class="line">     comment=<span class="string">&quot;Buy #48 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown46 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">48</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">49</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied47, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown47),</span><br><span class="line">     comment=<span class="string">&quot;Buy #49 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown47 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">49</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">50</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied48, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown48),</span><br><span class="line">     comment=<span class="string">&quot;Buy #50 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown48 * <span class="number">100</span>, format.percent))</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> strategy.opentrades == <span class="number">50</span> <span class="keyword">and</span> maxOrders &gt;= <span class="number">51</span></span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;Bull #1&quot;</span>, strategy.<span class="type">long</span>, qty=quantMultiplied49, limit=strategy.opentrades.<span class="built_in">entry_price</span>(<span class="number">0</span>) * (<span class="number">1</span> - avgDown49),</span><br><span class="line">     comment=<span class="string">&quot;Buy #51 &quot;</span> + str.<span class="built_in">tostring</span>(avgDown49 * <span class="number">100</span>, format.percent))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Exit Long Position</span></span><br><span class="line">stoplossPrice = <span class="number">0.0</span></span><br><span class="line"><span class="keyword">if</span> stoplossOn <span class="keyword">and</span> strategy.opentrades == maxOrders</span><br><span class="line">    stoplossPrice := strategy.opentrades.<span class="built_in">entry_price</span>(maxOrders - <span class="number">1</span>) * (<span class="number">1</span> - stoploss)</span><br><span class="line"></span><br><span class="line">strategy.<span class="built_in">exit</span>(<span class="string">&quot;Bull #1&quot;</span>, limit=strategy.position_avg_price * (<span class="number">1</span> + takeProfit), stop=stoplossOn <span class="keyword">and</span> strategy.opentrades == maxOrders ? stoplossPrice : na, comment_profit=<span class="string">&#x27;Take Profit On &#x27;</span> + str.<span class="built_in">tostring</span>(strategy.opentrades) + <span class="string">&quot; Orders&quot;</span>, comment_loss=<span class="string">&quot;Stoploss Hit @ -&quot;</span> + str.<span class="built_in">tostring</span>(stoploss*<span class="number">100</span>, <span class="string">&quot;#.##&quot;</span>) + <span class="string">&quot;% From Last Order&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Find Max Number Of Orders</span></span><br><span class="line">maxOrdersAtOnce = ta.<span class="built_in">highest</span>(strategy.opentrades, <span class="number">10000</span>)</span><br><span class="line">largestOrder = <span class="string">&quot;Highest # Of Open Trades &quot;</span> + str.<span class="built_in">tostring</span>(maxOrdersAtOnce, <span class="string">&quot;#.##&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Function that calculates the average amount of bars in a trade.</span></span><br><span class="line"><span class="built_in">avgBarsPerTrade</span>() =&gt;</span><br><span class="line">	sumBarsPerTrade = <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> tradeNo = <span class="number">0</span> to strategy.closedtrades - <span class="number">1</span></span><br><span class="line">		<span class="comment">// Loop through all closed trades, starting with the oldest.</span></span><br><span class="line">		sumBarsPerTrade += strategy.closedtrades.<span class="built_in">exit_bar_index</span>(tradeNo) - strategy.closedtrades.<span class="built_in">entry_bar_index</span>(tradeNo) + <span class="number">1</span></span><br><span class="line">	result = <span class="built_in">nz</span>(sumBarsPerTrade / strategy.closedtrades)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Label Text</span></span><br><span class="line">stoplossText = stoplossOn ? <span class="string">&quot;SL &quot;</span> + str.<span class="built_in">tostring</span>(stoploss*<span class="number">100</span>, <span class="string">&quot;#.##&quot;</span>) + <span class="string">&quot;%&quot;</span> : <span class="string">&quot;SL Off&quot;</span></span><br><span class="line">percToRecover = (((strategy.position_avg_price * (<span class="number">1</span> + takeProfit)) / close) - <span class="number">1</span>) * <span class="number">100</span></span><br><span class="line">avgPrice = <span class="string">&quot;Avg Price $&quot;</span> + str.<span class="built_in">tostring</span>(strategy.position_avg_price, <span class="string">&quot;#.##&quot;</span>)</span><br><span class="line">pnl = <span class="string">&quot;Trade PnL &quot;</span> + str.<span class="built_in">tostring</span>(((close - strategy.position_avg_price) / strategy.position_avg_price) * <span class="number">100</span>, format.percent)</span><br><span class="line">tpPrice = <span class="string">&quot;TP Price $&quot;</span> + str.<span class="built_in">tostring</span>(strategy.position_avg_price * (<span class="number">1</span> + takeProfit), <span class="string">&quot;#.##&quot;</span>)</span><br><span class="line">posSize = <span class="string">&quot;Pos Size &quot;</span> + str.<span class="built_in">tostring</span>(strategy.position_size, <span class="string">&quot;#.##&quot;</span>) + <span class="string">&quot; Units&quot;</span></span><br><span class="line">numOrders = <span class="string">&quot;# Of Open Orders &quot;</span> +str.<span class="built_in">tostring</span>(strategy.opentrades)</span><br><span class="line">percRecovery = <span class="string">&quot;From Take Profit &quot;</span> + str.<span class="built_in">tostring</span>(percToRecover, format.percent) + <span class="string">&quot;￪&quot;</span></span><br><span class="line">closedTrades = <span class="string">&quot;Total # Trades &quot;</span> + str.<span class="built_in">tostring</span>(strategy.closedtrades)</span><br><span class="line">initialCapital = <span class="string">&quot;Initial Capital $&quot;</span> + str.<span class="built_in">tostring</span>(strategy.initial_capital)</span><br><span class="line">maxDrawdown = <span class="string">&quot;Max Drawdown $&quot;</span> + str.<span class="built_in">tostring</span>(strategy.max_drawdown, <span class="string">&quot;#.##&quot;</span>)</span><br><span class="line">avgBarsPerTrade = <span class="string">&quot;Avg Bars Per Trade &quot;</span> + str.<span class="built_in">tostring</span>(<span class="built_in">avgBarsPerTrade</span>(), <span class="string">&quot;#&quot;</span>)</span><br><span class="line">grossProfit = <span class="string">&quot;Gross Profit $&quot;</span> + str.<span class="built_in">tostring</span>(strategy.grossprofit, <span class="string">&quot;#.##&quot;</span>)</span><br><span class="line">netProfit = <span class="string">&quot;Net Profit $&quot;</span> + str.<span class="built_in">tostring</span>(strategy.netprofit, <span class="string">&quot;#.##&quot;</span>)</span><br><span class="line">equity = <span class="string">&quot;Portfolio Value $&quot;</span> + str.<span class="built_in">tostring</span>(strategy.equity, <span class="string">&quot;#.##&quot;</span>)</span><br><span class="line">percentProfit = <span class="string">&quot;Percent Profit &quot;</span> + str.<span class="built_in">tostring</span>((strategy.netprofit/strategy.initial_capital)*<span class="number">100</span>, format.percent)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Plot Average Price, SL And TP Level</span></span><br><span class="line">avgPriceLine = <span class="built_in">plot</span>(strategy.position_avg_price, title=<span class="string">&quot;Position Average Price&quot;</span>, color=color.aqua, linewidth=<span class="number">4</span>)</span><br><span class="line">tpLevel = <span class="built_in">plot</span>(strategy.position_avg_price * (<span class="number">1</span>+takeProfit), title=<span class="string">&quot;Take Profit Level&quot;</span>, color=color.red, linewidth=<span class="number">4</span>)</span><br><span class="line">stopLevel = <span class="built_in">plot</span>(stoplossOn <span class="keyword">and</span> strategy.opentrades == maxOrders ? stoplossPrice : na, title=<span class="string">&quot;Stoploss Level&quot;</span>, color=color.orange, linewidth=<span class="number">2</span>, style=plot.style_cross)</span><br><span class="line"></span><br><span class="line"><span class="comment">//Plot Price Difference Table</span></span><br><span class="line">dataTable = table.<span class="built_in">new</span>(tablePosition, columns=<span class="number">2</span>, rows=<span class="number">19</span>, bgcolor=color.blue, frame_color=color.white, frame_width=<span class="number">1</span>, border_color=color.white, border_width=<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> dataTableOn</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">0</span>, text=<span class="string">&quot;Current Trade&quot;</span>, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center, bgcolor=color.navy)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">1</span>, text=avgPrice, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">2</span>, text=tpPrice, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">3</span>, text=pnl, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">4</span>, text=percRecovery, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">5</span>, text=posSize, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">6</span>, text=numOrders, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">7</span>, text=<span class="string">&quot;Overall Performance&quot;</span>, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center, bgcolor=color.navy)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">8</span>, text=closedTrades, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">9</span>, text=largestOrder, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">10</span>, text=maxDrawdown, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">11</span>, text=avgBarsPerTrade, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">12</span>, text=grossProfit, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">13</span>, text=netProfit, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">14</span>, text=percentProfit, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">15</span>, text=equity, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">0</span>, row=<span class="number">16</span>, text=initialCapital, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">1</span>, row=<span class="number">0</span>, text=<span class="string">&quot;Settings&quot;</span>, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center, bgcolor=color.navy)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">1</span>, row=<span class="number">1</span>, text=stoplossText, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center, bgcolor=color.purple)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">1</span>, row=<span class="number">2</span>, text=<span class="string">&quot;TP &quot;</span> + str.<span class="built_in">tostring</span>(takeProfit*<span class="number">100</span>) + <span class="string">&quot;%&quot;</span>, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center, bgcolor=color.purple)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">1</span>, row=<span class="number">3</span>, text=<span class="string">&quot;AD &quot;</span> + str.<span class="built_in">tostring</span>(avgDown*<span class="number">100</span>) + <span class="string">&quot;%&quot;</span>, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center, bgcolor=color.purple)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">1</span>, row=<span class="number">4</span>, text=<span class="string">&quot;AD%M &quot;</span> + str.<span class="built_in">tostring</span>(percentScale) + <span class="string">&quot;x&quot;</span>, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center, bgcolor=color.purple)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">1</span>, row=<span class="number">5</span>, text=<span class="string">&quot;VM &quot;</span> + str.<span class="built_in">tostring</span>(multiplier) + <span class="string">&quot;x&quot;</span>, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center, bgcolor=color.purple)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">1</span>, row=<span class="number">6</span>, text=<span class="string">&quot;M#O &quot;</span> + str.<span class="built_in">tostring</span>(maxOrders), height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center, bgcolor=color.purple)</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=dataTable, column=<span class="number">1</span>, row=<span class="number">7</span>, text=<span class="string">&quot;BO $&quot;</span> + str.<span class="built_in">tostring</span>(quantity), height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center, bgcolor=color.purple)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Share price too high for base order label</span></span><br><span class="line">warningTable = table.<span class="built_in">new</span>(position.top_center, columns=<span class="number">1</span>, rows=<span class="number">1</span>, bgcolor=color.orange)</span><br><span class="line"><span class="keyword">if</span> strategy.closedtrades == <span class="number">0</span> <span class="keyword">and</span> close &gt; quantity</span><br><span class="line">    table.<span class="built_in">cell</span>(table_id=warningTable, column=<span class="number">0</span>, row=<span class="number">0</span>, text=<span class="string">&quot;Share Price Is Higher Than Base Order&quot;</span>, height=<span class="number">0</span>, text_color=color.white, text_halign=text.align_left, text_valign= text.align_center)</span><br></pre></td></tr></table></figure>

<h5 id="海龟"><a href="#海龟" class="headerlink" title="海龟"></a>海龟</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//@version=4</span></span><br><span class="line"><span class="comment">//Based on Turtle traders strategy: buy/sell on Donchian breakouts and stop loss on ATR 2x</span></span><br><span class="line"><span class="comment">// initial version considerations :</span></span><br><span class="line"><span class="comment">//// 1. Does not consider filter for avoiding new entries after winning trades (filtering rule from Turtle Strategy on 20 day breakout strategy) </span></span><br><span class="line"><span class="comment">//// 2. Does not consider pyramiding (aditional entries after 1N price movements)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">strategy</span>(<span class="string">&quot;Turtle trading strategy (Donchian/ATR)&quot;</span>, overlay=<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">enter_period = <span class="built_in">input</span>(<span class="number">20</span>, minval=<span class="number">1</span>, title=<span class="string">&quot;Enter Channel&quot;</span>)</span><br><span class="line">exit_period = <span class="built_in">input</span>(<span class="number">10</span>, minval=<span class="number">1</span>, title=<span class="string">&quot;Exit Channel&quot;</span>)</span><br><span class="line">offset_bar = <span class="built_in">input</span>(<span class="number">0</span>,minval=<span class="number">0</span>, title =<span class="string">&quot;Offset Bars&quot;</span>)</span><br><span class="line">direction = <span class="built_in">input</span>(<span class="string">&quot;Long&quot;</span>,options=[<span class="string">&quot;Long&quot;</span>,<span class="string">&quot;Short&quot;</span>],title=<span class="string">&quot;Direction&quot;</span>)</span><br><span class="line">max_length = <span class="built_in">max</span>(enter_period,exit_period)</span><br><span class="line">atrmult = <span class="built_in">input</span>(<span class="number">2.0</span>,title=<span class="string">&quot;ATR multiplier (Stop Loss)&quot;</span>)</span><br><span class="line">atrperiod = <span class="built_in">input</span>(<span class="number">20</span>,title=<span class="string">&quot;ATR Period&quot;</span>)</span><br><span class="line"></span><br><span class="line">closed_pos = <span class="literal">false</span></span><br><span class="line">dir_long = direction == <span class="string">&quot;Long&quot;</span>? <span class="literal">true</span> : <span class="literal">false</span></span><br><span class="line">atr=<span class="built_in">ema</span>(<span class="built_in">tr</span>(<span class="literal">true</span>),atrperiod)</span><br><span class="line">atrstop = atrmult*atr</span><br><span class="line">upper = dir_long ? <span class="built_in">highest</span>(enter_period): <span class="built_in">highest</span>(exit_period)</span><br><span class="line">lower = dir_long ? <span class="built_in">lowest</span>(exit_period): <span class="built_in">lowest</span>(enter_period)</span><br><span class="line">atrupper = <span class="built_in">ema</span>(close + atrstop,<span class="number">3</span>)</span><br><span class="line">atrlower = <span class="built_in">ema</span>(close - atrstop,<span class="number">3</span>)</span><br><span class="line">atrupper_incpos = close + atr</span><br><span class="line">atrlower_incpos = close - atr</span><br><span class="line">plotted_atr = dir_long ? atrlower : atrupper</span><br><span class="line">atr_incpos = dir_long ? atrupper_incpos : atrlower_incpos</span><br><span class="line"></span><br><span class="line"><span class="comment">//basis = avg(upper, lower)</span></span><br><span class="line"></span><br><span class="line">l = <span class="built_in">plot</span>(lower, style=plot.style_line, linewidth=<span class="number">3</span>, color=color.lime, offset=<span class="number">1</span>)</span><br><span class="line">u = <span class="built_in">plot</span>(upper, style=plot.style_line, linewidth=<span class="number">3</span>, color=color.lime, offset=<span class="number">1</span>)</span><br><span class="line">a = <span class="built_in">plot</span>(plotted_atr, style=plot.style_line,linewidth=<span class="number">2</span>,color=color.red,offset=<span class="number">1</span>)</span><br><span class="line">lin = line.<span class="built_in">new</span>(x1=bar_index[<span class="number">5</span>],x2=bar_index,y1=atr_incpos,y2=atr_incpos,color=color.lime,style=line.style_dashed)</span><br><span class="line">line.<span class="built_in">set_width</span>(lin,<span class="number">2</span>)</span><br><span class="line">line.<span class="built_in">delete</span>(lin[<span class="number">4</span>])</span><br><span class="line"><span class="comment">//plot(basis, color=yellow, style=line, linewidth=1, title=&quot;Mid-Line Average&quot;)</span></span><br><span class="line"><span class="comment">//break upper Donchian (with 1 candle offset) (buy signal)</span></span><br><span class="line">break_up = (close &gt;= upper[<span class="number">1</span>])</span><br><span class="line"><span class="comment">//break lower Donchian (with 1 candle offset) (sell signal)</span></span><br><span class="line">break_down = (close &lt;= lower[<span class="number">1</span>])</span><br><span class="line">stop_loss = dir_long ? (close&lt;=plotted_atr[<span class="number">1</span>]) : (close&gt;=plotted_atr[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> break_up <span class="keyword">and</span> dir_long</span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;buy&quot;</span>, strategy.<span class="type">long</span>, <span class="number">1</span>)</span><br><span class="line">    closed_pos :=<span class="literal">false</span></span><br><span class="line"><span class="keyword">if</span> (break_down <span class="keyword">or</span> stop_loss) <span class="keyword">and</span> dir_long</span><br><span class="line">    strategy.<span class="built_in">close</span>(<span class="string">&quot;buy&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> break_down <span class="keyword">and</span> <span class="keyword">not</span> dir_long</span><br><span class="line">    strategy.<span class="built_in">entry</span>(<span class="string">&quot;sell&quot;</span>, strategy.<span class="type">short</span>, <span class="number">1</span>)</span><br><span class="line">    closed_pos :=<span class="literal">false</span></span><br><span class="line"><span class="keyword">if</span> (break_up <span class="keyword">or</span> stop_loss) <span class="keyword">and</span> <span class="keyword">not</span> dir_long</span><br><span class="line">    strategy.<span class="built_in">close</span>(<span class="string">&quot;sell&quot;</span>)</span><br><span class="line">    closed_pos :=<span class="literal">true</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">alertcondition</span>(<span class="literal">true</span>, <span class="string">&#x27;TurtleTest&#x27;</span>, <span class="string">&#x27;Teste Estratégia Turtle&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h5 id="macd"><a href="#macd" class="headerlink" title="macd"></a>macd</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">//@version=5</span></span><br><span class="line"><span class="built_in">indicator</span>(title=<span class="string">&quot;Moving Average Convergence Divergence&quot;</span>, shorttitle=<span class="string">&quot;MACD&quot;</span>, timeframe=<span class="string">&quot;&quot;</span>, timeframe_gaps=<span class="literal">true</span>)</span><br><span class="line"><span class="comment">// Getting inputs</span></span><br><span class="line">fast_length = <span class="built_in">input</span>(title = <span class="string">&quot;Fast Length&quot;</span>, defval = <span class="number">12</span>)</span><br><span class="line">slow_length = <span class="built_in">input</span>(title = <span class="string">&quot;Slow Length&quot;</span>, defval = <span class="number">26</span>)</span><br><span class="line">src = <span class="built_in">input</span>(title = <span class="string">&quot;Source&quot;</span>, defval = close)</span><br><span class="line">signal_length = input.<span class="built_in">int</span>(title = <span class="string">&quot;Signal Smoothing&quot;</span>,  minval = <span class="number">1</span>, maxval = <span class="number">50</span>, defval = <span class="number">9</span>)</span><br><span class="line">sma_source = input.<span class="built_in">string</span>(title = <span class="string">&quot;Oscillator MA Type&quot;</span>,  defval = <span class="string">&quot;EMA&quot;</span>, options = [<span class="string">&quot;SMA&quot;</span>, <span class="string">&quot;EMA&quot;</span>])</span><br><span class="line">sma_signal = input.<span class="built_in">string</span>(title = <span class="string">&quot;Signal Line MA Type&quot;</span>, defval = <span class="string">&quot;EMA&quot;</span>, options = [<span class="string">&quot;SMA&quot;</span>, <span class="string">&quot;EMA&quot;</span>])</span><br><span class="line"><span class="comment">// Calculating</span></span><br><span class="line">fast_ma = sma_source == <span class="string">&quot;SMA&quot;</span> ? ta.<span class="built_in">sma</span>(src, fast_length) : ta.<span class="built_in">ema</span>(src, fast_length)</span><br><span class="line">slow_ma = sma_source == <span class="string">&quot;SMA&quot;</span> ? ta.<span class="built_in">sma</span>(src, slow_length) : ta.<span class="built_in">ema</span>(src, slow_length)</span><br><span class="line">macd = fast_ma - slow_ma</span><br><span class="line">signal = sma_signal == <span class="string">&quot;SMA&quot;</span> ? ta.<span class="built_in">sma</span>(macd, signal_length) : ta.<span class="built_in">ema</span>(macd, signal_length)</span><br><span class="line">hist = macd - signal</span><br><span class="line"></span><br><span class="line"><span class="built_in">alertcondition</span>(hist[<span class="number">1</span>] &gt;= <span class="number">0</span> <span class="keyword">and</span> hist &lt; <span class="number">0</span>, title = <span class="string">&#x27;Rising to falling&#x27;</span>, message = <span class="string">&#x27;The MACD histogram switched from a rising to falling state&#x27;</span>)</span><br><span class="line"><span class="built_in">alertcondition</span>(hist[<span class="number">1</span>] &lt;= <span class="number">0</span> <span class="keyword">and</span> hist &gt; <span class="number">0</span>, title = <span class="string">&#x27;Falling to rising&#x27;</span>, message = <span class="string">&#x27;The MACD histogram switched from a falling to rising state&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">hline</span>(<span class="number">0</span>, <span class="string">&quot;Zero Line&quot;</span>, color = color.<span class="built_in">new</span>(#<span class="number">787B</span>86, <span class="number">50</span>))</span><br><span class="line"><span class="built_in">plot</span>(hist, title = <span class="string">&quot;Histogram&quot;</span>, style = plot.style_columns, color = (hist &gt;= <span class="number">0</span> ? (hist[<span class="number">1</span>] &lt; hist ? #<span class="number">26</span>A69A : #B2DFDB) : (hist[<span class="number">1</span>] &lt; hist ? #FFCDD2 : #FF5252)))</span><br><span class="line"><span class="built_in">plot</span>(macd,   title = <span class="string">&quot;MACD&quot;</span>,   color = #<span class="number">2962F</span>F)</span><br><span class="line"><span class="built_in">plot</span>(signal, title = <span class="string">&quot;Signal&quot;</span>, color = #FF6D00)</span><br></pre></td></tr></table></figure>





<h3 id="🌟-CTP"><a href="#🌟-CTP" class="headerlink" title="🌟 CTP"></a>🌟 CTP</h3><h4 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h4><h5 id="1-闹钟模块"><a href="#1-闹钟模块" class="headerlink" title="1.闹钟模块"></a>1.闹钟模块</h5><figure class="highlight gml"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">alarm</span>/</span><br><span class="line">    __init__.py</span><br><span class="line">    <span class="variable language_">alarm</span>.py</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%AF%95%E8%AE%BE/" rel="tag"># 毕设</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/08/20/vnpy/" rel="prev" title="vnpy">
      <i class="fa fa-chevron-left"></i> vnpy
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/01/03/%E6%9C%9F%E6%9D%83/" rel="next" title="期权">
      期权 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%AA%90-%E5%85%B3%E6%B3%A8%E5%88%97%E8%A1%A8"><span class="nav-number">1.</span> <span class="nav-text">🪐 关注列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8C%9F-%E4%B8%93%E6%9C%89%E5%90%8D%E8%AF%8D"><span class="nav-number">2.</span> <span class="nav-text">🌟 专有名词</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8C%9F-TradingView"><span class="nav-number">3.</span> <span class="nav-text">🌟 TradingView</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E7%B4%A0%E6%9D%90"><span class="nav-number">3.1.</span> <span class="nav-text">脚本素材</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A7%BB%E5%8A%A8%E6%AD%A2%E7%9B%88"><span class="nav-number">3.1.1.</span> <span class="nav-text">移动止盈</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AE%B1%E4%BD%93%E7%AA%81%E7%A0%B4"><span class="nav-number">3.1.2.</span> <span class="nav-text">箱体突破</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%A9%AC%E4%B8%81"><span class="nav-number">3.1.3.</span> <span class="nav-text">马丁</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%B7%E9%BE%9F"><span class="nav-number">3.1.4.</span> <span class="nav-text">海龟</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#macd"><span class="nav-number">3.1.5.</span> <span class="nav-text">macd</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8C%9F-CTP"><span class="nav-number">4.</span> <span class="nav-text">🌟 CTP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97"><span class="nav-number">4.1.</span> <span class="nav-text">模块</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E9%97%B9%E9%92%9F%E6%A8%A1%E5%9D%97"><span class="nav-number">4.1.1.</span> <span class="nav-text">1.闹钟模块</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="kjg"
      src="/images/WechatIMG84.jpeg">
  <p class="site-author-name" itemprop="name">kjg</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">163</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">69</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/kjgggggg" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;kjgggggg" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/651373472@qq.com" title="E-Mail → 651373472@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
</div>

<span style="text-align:center;display:block;">
<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span <div>wmr</div> </span>
</span>

        
<span style="text-align:center;display:block;">
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        本站总访问人数：
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider"></span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        本站总访问量： 
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
</span>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  
<script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '16px',
  right: '28px',
  left: 'unset',
  time: '0.3s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>

</body>
</html>
