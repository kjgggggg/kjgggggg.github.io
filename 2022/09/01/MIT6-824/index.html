<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"kjgggggg.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":false,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"./public/public/search.xml"};
  </script>

  <meta name="description" content="MIT6.824">
<meta property="og:type" content="article">
<meta property="og:title" content="MIT6.824">
<meta property="og:url" content="https://kjgggggg.github.io/2022/09/01/MIT6-824/index.html">
<meta property="og:site_name" content="kjg&#39;s blog">
<meta property="og:description" content="MIT6.824">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kjgggggg.github.io/2022/09/01/MIT6-824/image-20230401215921894.png">
<meta property="og:image" content="https://kjgggggg.github.io/2022/09/01/MIT6-824/image-20230403000919945.png">
<meta property="article:published_time" content="2022-09-01T13:18:15.000Z">
<meta property="article:modified_time" content="2023-04-03T05:42:57.509Z">
<meta property="article:author" content="kjg">
<meta property="article:tag" content="MIT6.824">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kjgggggg.github.io/2022/09/01/MIT6-824/image-20230401215921894.png">

<link rel="canonical" href="https://kjgggggg.github.io/2022/09/01/MIT6-824/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MIT6.824 | kjg's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">kjg's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://kjgggggg.github.io/2022/09/01/MIT6-824/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/WechatIMG84.jpeg">
      <meta itemprop="name" content="kjg">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kjg's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MIT6.824
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2022-09-01 21:18:15" itemprop="dateCreated datePublished" datetime="2022-09-01T21:18:15+08:00">2022-09-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-04-03 13:42:57" itemprop="dateModified" datetime="2023-04-03T13:42:57+08:00">2023-04-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MIT6-824/" itemprop="url" rel="index"><span itemprop="name">MIT6.824</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <div class="post-description">MIT6.824</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="æ–‡ä»¶ç»“æ„"><a href="#æ–‡ä»¶ç»“æ„" class="headerlink" title="æ–‡ä»¶ç»“æ„"></a>æ–‡ä»¶ç»“æ„</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">/Users/jiangangkong/workSpace/vscodeWorkSpace/<span class="number">6.824</span></span><br><span class="line">- Makefile	</span><br><span class="line">- src</span><br><span class="line">    - <span class="keyword">go</span>.mod		</span><br><span class="line">    - labgob		</span><br><span class="line">		labgob.<span class="keyword">go</span>	test_test.<span class="keyword">go</span></span><br><span class="line">    - models		</span><br><span class="line">		kv.<span class="keyword">go</span></span><br><span class="line">    - porcupine	</span><br><span class="line">		bitset.<span class="keyword">go</span>		model.<span class="keyword">go</span>		visualization.<span class="keyword">go</span></span><br><span class="line">		checker.<span class="keyword">go</span>		porcupine.<span class="keyword">go</span></span><br><span class="line">    - shardkv</span><br><span class="line">		client.<span class="keyword">go</span>	common.<span class="keyword">go</span>	config.<span class="keyword">go</span>	server.<span class="keyword">go</span>	test_test.<span class="keyword">go</span></span><br><span class="line">    - <span class="keyword">go</span>.sum		</span><br><span class="line">    - labrpc	</span><br><span class="line">		labrpc.<span class="keyword">go</span>	test_test.<span class="keyword">go</span></span><br><span class="line">    - mr		</span><br><span class="line">		coordinator.<span class="keyword">go</span>	  rpc.<span class="keyword">go</span>	worker.<span class="keyword">go</span></span><br><span class="line">    - raft</span><br><span class="line">		config.<span class="keyword">go</span>	persister.<span class="keyword">go</span>	raft.<span class="keyword">go</span>		test_test.<span class="keyword">go</span>	util.<span class="keyword">go</span></span><br><span class="line">    - kvraft</span><br><span class="line">		client.<span class="keyword">go</span>	common.<span class="keyword">go</span>	config.<span class="keyword">go</span>	server.<span class="keyword">go</span>	test_test.<span class="keyword">go</span></span><br><span class="line">    - main	</span><br><span class="line">		diskvd.<span class="keyword">go</span>			pbd.<span class="keyword">go</span>					pg-sherlock_holmes.txt</span><br><span class="line">        lockc.<span class="keyword">go</span>			pg-being_ernest.txt		pg-tom_sawyer.txt</span><br><span class="line">        lockd.<span class="keyword">go</span>			pg-dorian_gray.txt		test-mr-many.sh</span><br><span class="line">        mrcoordinator.<span class="keyword">go</span>	pg-frankenstein.txt		test-mr.sh</span><br><span class="line">        mrsequential.<span class="keyword">go</span>		pg-grimm.txt			viewd.<span class="keyword">go</span></span><br><span class="line">        mrworker.<span class="keyword">go</span>			pg-huckleberry_finn.txt</span><br><span class="line">        pbc.<span class="keyword">go</span>				pg-metamorphosis.txt</span><br><span class="line">    - mrapps	</span><br><span class="line">		crash.<span class="keyword">go</span>		indexer.<span class="keyword">go</span>		mtiming.<span class="keyword">go</span>		rtiming.<span class="keyword">go</span></span><br><span class="line">		early_exit.<span class="keyword">go</span>	jobcount.<span class="keyword">go</span>		nocrash.<span class="keyword">go</span>		wc.<span class="keyword">go</span></span><br><span class="line">    - shardctrler</span><br><span class="line">		client.<span class="keyword">go</span>	common.<span class="keyword">go</span>	config.<span class="keyword">go</span>	server.<span class="keyword">go</span>	test_test.<span class="keyword">go</span></span><br></pre></td></tr></table></figure>







<h3 id="Lab-1-MapReduce"><a href="#Lab-1-MapReduce" class="headerlink" title="Lab 1: MapReduce"></a>Lab 1: MapReduce</h3><p><strong>Introduction</strong></p>
<p>åœ¨æœ¬å®éªŒä¸­ï¼Œæ‚¨å°†æ„å»ºä¸€ä¸ªMapReduceç³»ç»Ÿã€‚æ‚¨å°†å®ç°ä¸€ä¸ªè°ƒç”¨åº”ç”¨ç¨‹åºMapå’ŒReduceå‡½æ•°å¹¶å¤„ç†æ–‡ä»¶è¯»å†™çš„å·¥ä½œè¿›ç¨‹ï¼Œä»¥åŠä¸€ä¸ªå°†ä»»åŠ¡åˆ†å‘ç»™workersè¿›ç¨‹å¹¶å¤„ç†å¤±è´¥çš„å·¥ä½œè¿›ç¨‹çš„masterè¿›ç¨‹ã€‚æ‚¨å°†æ„å»ºä¸MapReduceè®ºæ–‡ç±»ä¼¼çš„ä¸œè¥¿</p>
<p><strong>Getting started</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /Users/jiangangkong/workSpace/vscodeWorkSpace</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git://g.csail.mit.edu/6.824-golabs-2020 6.824</span><br><span class="line"><span class="built_in">cd</span> 6.824</span><br><span class="line"><span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<img src="/2022/09/01/MIT6-824/image-20230401215921894.png" alt="image-20230401215921894" style="zoom:50%;">

<p>æˆ‘ä»¬åœ¨ <code>src/main/mrsequential.go</code>ä¸ºä½ æä¾›äº†ä¸€ä¸ªç®€å•çš„  sequential mapreduce å®ç°  It runs the maps and reduces one at a time, in a single process. </p>
<p>We also provide you with a couple of MapReduce applications:  </p>
<p>å•è¯è®¡æ•°å™¨ <code>mrapps/wc.go</code>,  æ–‡æœ¬ç´¢å¼•å™¨  <code>mrapps/indexer.go</code>. ä½ å¯ä»¥æŒ‰å¦‚ä¸‹æŒ‡ä»¤è¿è¡Œå®ƒä»¬</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /Users/jiangangkong/workSpace/vscodeWorkSpace/6.824</span><br><span class="line"><span class="built_in">cd</span> src/main</span><br><span class="line"><span class="comment"># ä½¿ç”¨ Go å·¥å…·é“¾ä¸­çš„ go build å‘½ä»¤æ¥æ„å»ºä¸€ä¸ªæ’ä»¶ï¼Œæ’ä»¶çš„æºä»£ç æ˜¯ ../mrapps/wc.go æ–‡ä»¶</span></span><br><span class="line">go build -buildmode=plugin ../mrapps/wc.go</span><br><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰ä»¥ &quot;mr-out&quot; å¼€å¤´çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ &quot;mr-out-1.txt&quot;ï¼Œ&quot;mr-out-2.txt&quot;</span></span><br><span class="line"><span class="built_in">rm</span> mr-out*</span><br><span class="line"><span class="comment"># ä½¿ç”¨wc.soä½œä¸šå’Œæ‰€æœ‰ä»¥pgå¼€å¤´å¹¶ä»¥.txtç»“å°¾çš„å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶ä½œä¸ºè¾“å…¥æ¥è¿è¡Œmrsequential.goç¨‹åº</span></span><br><span class="line"><span class="comment"># mrsequential.go ç¨‹åºå°†è¯»å–è¾“å…¥æ–‡ä»¶ï¼Œä½¿ç”¨ wc.so ä½œä¸šè¿›è¡Œå¤„ç†ï¼Œå¹¶è¾“å‡ºç»“æœ</span></span><br><span class="line">go run mrsequential.go wc.so pg*.txt </span><br><span class="line">more mr-out-0 <span class="comment"># æŸ¥çœ‹æ–‡ä»¶å†…å®¹ Qé€€å‡ºmoreæ¨¡å¼</span></span><br></pre></td></tr></table></figure>

<p>è¯·éšæ„ä»mrsequence .goä¸­å€Ÿç”¨ä»£ç ã€‚æ‚¨è¿˜åº”è¯¥çœ‹çœ‹mrapps&#x2F;wcã€‚å»çœ‹çœ‹MapReduceåº”ç”¨ç¨‹åºä»£ç æ˜¯ä»€ä¹ˆæ ·çš„</p>
<p><strong>Your Job</strong></p>
<p>æ‚¨çš„å·¥ä½œæ˜¯å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼MapReduceï¼Œç”±ä¸¤ä¸ªç¨‹åºç»„æˆ, the master and the worker. There will be just one master process, and one or more worker processes executing in parallel. </p>
<p>The workers will talk to the master via RPC. Each worker process will ask the master for a task, read the taskâ€™s input from one or more files, execute the task, and write the taskâ€™s output to one or more files. The master should notice if a worker hasnâ€™t completed its task in a reasonable amount of time (for this lab, use ten seconds), and give the same task to a different worker.</p>
<p>ä¸ºæ–¹ä¾¿ä½ å¼€å§‹ï¼ŒThe â€œmainâ€ routines for the master and worker are in <code>main/mrmaster.go</code> and <code>main/mrworker.go</code>; </p>
<p>donâ€™t change these files. Put your implementation in <code>mr/master.go</code>, <code>mr/worker.go</code>, and <code>mr/rpc.go</code>.</p>
<p><strong>Run your code</strong></p>
<p>Hereâ€™s how to run your code on the word-count MapReduce application.</p>
<p>First, make sure the word-count plugin is freshly built:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go build -buildmode=plugin ../mrapps/wc.go</span><br></pre></td></tr></table></figure>

<p>In the <code>main</code> directory, run the master.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> mr-out*</span><br><span class="line">go run mrmaster.go pg-*.txt</span><br></pre></td></tr></table></figure>

<p>The <code>pg-*.txt</code> arguments to <code>mrmaster.go</code> are the input files; each file corresponds to one â€œsplitâ€, and is the input to one Map task.</p>
<p>In one or more other windows, run some workers:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go run mrworker.go wc.so</span><br></pre></td></tr></table></figure>

<p>When the workers and master have finished, look at the output in <code>mr-out-*</code>. When youâ€™ve completed the lab, the sorted union of the output files should match the sequential output, like this:</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cat</span> mr-<span class="keyword">out</span>-* | <span class="keyword">sort</span> | <span class="keyword">more</span></span><br><span class="line"></span><br><span class="line">A 509</span><br><span class="line"><span class="keyword">ABOUT</span> 2</span><br><span class="line">ACT 8</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>We supply you with a test script in <code>main/test-mr.sh</code>. The tests check that the <code>wc</code> and <code>indexer</code> MapReduce applications produce the correct output when given the <code>pg-xxx.txt</code> files as input. The tests also check that your implementation runs the Map and Reduce tasks in parallel, and that your implementation recovers from workers that crash while running tasks.</p>
<p>If you run the test script now, it will hang because the master never finishes:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/6.824/src/main</span><br><span class="line">sh test-mr.sh</span><br><span class="line">*** Starting <span class="built_in">wc</span> <span class="built_in">test</span>.</span><br></pre></td></tr></table></figure>

<p>You can change <code>ret := false</code> to true in the Done function in <code>mr/master.go</code> so that the master exits immediately. Then:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sh ./test-mr.sh</span><br><span class="line">*** Starting <span class="built_in">wc</span> <span class="built_in">test</span>.</span><br><span class="line"><span class="built_in">sort</span>: No such file or directory</span><br><span class="line">cmp: EOF on mr-wc-all</span><br><span class="line">--- <span class="built_in">wc</span> output is not the same as mr-correct-wc.txt</span><br><span class="line">--- <span class="built_in">wc</span> <span class="built_in">test</span>: FAIL</span><br></pre></td></tr></table></figure>

<p>The test script expects to see output in files named <code>mr-out-X</code>, one for each reduce task. The empty implementations of <code>mr/master.go</code> and <code>mr/worker.go</code> donâ€™t produce those files (or do much of anything else), so the test fails.</p>
<p>When youâ€™ve finished, the test script output should look like this:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sh ./test-mr.sh</span><br><span class="line">*** Starting <span class="built_in">wc</span> <span class="built_in">test</span>.</span><br><span class="line">--- <span class="built_in">wc</span> <span class="built_in">test</span>: PASS</span><br><span class="line">*** Starting indexer <span class="built_in">test</span>.</span><br><span class="line">--- indexer <span class="built_in">test</span>: PASS</span><br><span class="line">*** Starting map parallelism <span class="built_in">test</span>.</span><br><span class="line">--- map parallelism <span class="built_in">test</span>: PASS</span><br><span class="line">*** Starting reduce parallelism <span class="built_in">test</span>.</span><br><span class="line">--- reduce parallelism <span class="built_in">test</span>: PASS</span><br><span class="line">*** Starting crash <span class="built_in">test</span>.</span><br><span class="line">--- crash <span class="built_in">test</span>: PASS</span><br><span class="line">*** PASSED ALL TESTS</span><br></pre></td></tr></table></figure>

<p>Youâ€™ll also see some errors from the Go RPC package that look like</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">2019/12/16 13:27:09 rpc.Register: method <span class="string">&quot;Done&quot;</span> has 1 input parameters; needs exactly three</span><br></pre></td></tr></table></figure>

<p>Ignore these messages.</p>
<h4 id="A-few-rules"><a href="#A-few-rules" class="headerlink" title="A few rules:"></a>A few rules:</h4><ul>
<li><p>map é˜¶æ®µ should divide the intermediate keys into buckets for <code>nReduce</code> reduce tasks, where <code>nReduce</code> is the argument that <code>main/mrmaster.go</code> passes to <code>MakeMaster()</code>.</p>
</li>
<li><p>The worker implementation should put the output of the Xâ€™th reduce task in the file <code>mr-out-X</code>.</p>
</li>
<li><p>A <code>mr-out-X</code> file should contain one line per Reduce function output. The line should be generated with the Go <code>&quot;%v %v&quot;</code> format, called with the key and value. Have a look in <code>main/mrsequential.go</code></p>
</li>
<li><p><code>main/mrmaster.go</code> expects <code>mr/master.go</code> to implement a <code>Done()</code> method that returns true when the MapReduce job is completely finished; at that point, <code>mrmaster.go</code> will exit.</p>
</li>
<li><p>When the job is completely finished, the worker processes should exit. A simple way to implement this is to use the return value from <code>call()</code>: if the worker fails to contact the master, it can assume that the master has exited because the job is done, and so the worker can terminate too. Depending on your design, you might also find it helpful to have a â€œplease exitâ€ pseudo-task ï¼ˆä¼ªä»»åŠ¡ï¼‰ that the master can give to workers</p>
</li>
</ul>
<h4 id="Hints"><a href="#Hints" class="headerlink" title="Hints"></a>Hints</h4><ul>
<li><p><strong>One way to get started</strong> is to modify <code>mr/worker.go</code>ä¸­çš„ <code>Worker()</code> to send an RPC to the master asking for a task. Then modify the master to respond with the file name of an å°šæœªå¯åŠ¨çš„ map task. Then modify the worker to read that file and call the application Map function, as in <code>mrsequential.go</code>.</p>
</li>
<li><p>ä¸­é—´æ–‡ä»¶çš„åˆç†å‘½åçº¦å®šæ˜¯mr-X-Yï¼Œå…¶ä¸­Xæ˜¯Mapä»»åŠ¡ç¼–å·ï¼ŒYæ˜¯reduceä»»åŠ¡ç¼–å·</p>
</li>
<li><p>Workersçš„mapéƒ¨åˆ†å¯ä»¥ä½¿ç”¨ihash(key)å‡½æ•°ä¸ºç»™å®šçš„keyé€‰æ‹©reduceä»»åŠ¡</p>
</li>
<li><p>Workers æœ‰æ—¶éœ€è¦ç­‰å¾…ï¼Œreduces canâ€™t start until the last map has finished. One possibility is for workers to periodically ask the master for work, sleeping with <code>time.Sleep()</code> between each request. Another possibility is for the relevant RPC handler in the master to have a loop that waits, either with <code>time.Sleep()</code> or <code>sync.Cond</code>. Go runs the handler for each RPC in its own thread, so the fact that one handler is waiting wonâ€™t prevent the master from processing other RPCs.</p>
</li>
</ul>
<h4 id="â€»æµç¨‹"><a href="#â€»æµç¨‹" class="headerlink" title="â€»æµç¨‹"></a>â€»æµç¨‹</h4><p><img src="/2022/09/01/MIT6-824/image-20230403000919945.png" alt="image-20230403000919945"></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">run main/mrcoordinator.<span class="keyword">go</span> XXX*.txt</span><br><span class="line">-&gt; è°ƒç”¨ mr/coordinator.<span class="keyword">go</span>/MakeCoordinator() åˆå§‹åŒ– c *Coordinato  </span><br><span class="line">-&gt; è°ƒç”¨ c.server() start a thread that listens <span class="keyword">for</span> RPCs from worker.<span class="keyword">go</span></span><br><span class="line">-&gt; è°ƒç”¨ <span class="keyword">go</span> c.schedule() å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è°ƒåº¦ä»»åŠ¡æ‰§è¡Œï¼Œæ ¹æ®é˜¶æ®µå’Œä»»åŠ¡çŠ¶æ€åˆ†é…æ–°ä»»åŠ¡ï¼Œ</span><br><span class="line">   å¤„ç†å·¥ä½œèŠ‚ç‚¹çš„å¿ƒè·³å’ŒæŠ¥å‘Šä¿¡æ¯ï¼Œå¹¶å°†ä»»åŠ¡åˆ†é…ç»™ç©ºé—²å·¥ä½œèŠ‚ç‚¹</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Coordinator)</span></span> schedule() &#123;</span><br><span class="line">	c.initMapPhase() <span class="comment">// è¿›å…¥ Map æµç¨‹, å°†æ‰€æœ‰.txtæ–‡ä»¶å°è£…æˆtask æ”¾å…¥ c.tasks</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿›å…¥ä¸€ä¸ªæ— é™å¾ªç¯ä¸­ï¼Œé€šè¿‡ select è¯­å¥ç›‘å¬ä¸¤ä¸ªé€šé“ï¼šheartbeatCh å’Œ reportCh</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="comment">// å½“ä»heartbeatChä¸­æ”¶åˆ°æ¶ˆæ¯æ—¶, å®ƒä¼šæ ¹æ®å½“å‰ä»»åŠ¡çš„é˜¶æ®µ</span></span><br><span class="line">        <span class="comment">//ï¼ˆMapPhaseã€ReducePhase æˆ– CompletePhaseï¼‰æ¥é€‰æ‹©ä¸€ä¸ªä»»åŠ¡å¹¶å°†å…¶åˆ†é…ç»™ä¸€ä¸ªå¯ç”¨çš„ Worker</span></span><br><span class="line">		<span class="keyword">case</span> msg := &lt;-c.heartbeatCh:</span><br><span class="line">			<span class="keyword">if</span> c.phase == CompletePhase &#123;</span><br><span class="line">				msg.response.JobType = CompleteJob</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> c.selectTask(msg.response) &#123;</span><br><span class="line">				<span class="keyword">switch</span> c.phase &#123;</span><br><span class="line">				<span class="keyword">case</span> MapPhase:</span><br><span class="line">					log.Printf(<span class="string">&quot;Coordinator: %v finished, start %v \n&quot;</span>, MapPhase, ReducePhase)</span><br><span class="line">					c.initReducePhase()</span><br><span class="line">					c.selectTask(msg.response) <span class="comment">// å¹¶æ”¹å†™ msg.response</span></span><br><span class="line">				<span class="keyword">case</span> ReducePhase:</span><br><span class="line">					log.Printf(<span class="string">&quot;Coordinator: %v finished, Congratulations \n&quot;</span>, ReducePhase)</span><br><span class="line">					c.initCompletePhase()</span><br><span class="line">					msg.response.JobType = CompleteJob</span><br><span class="line">				<span class="keyword">case</span> CompletePhase:</span><br><span class="line">					<span class="built_in">panic</span>(fmt.Sprintf(<span class="string">&quot;Coordinator: enter unexpected branch&quot;</span>))</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			log.Printf(<span class="string">&quot;Coordinator: assigned a task %v to worker \n&quot;</span>, msg.response)</span><br><span class="line">			msg.ok &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">		<span class="keyword">case</span> msg := &lt;-c.reportCh:</span><br><span class="line">			<span class="keyword">if</span> msg.request.Phase == c.phase &#123;</span><br><span class="line">				log.Printf(<span class="string">&quot;Coordinator: Worker has executed task %v \n&quot;</span>, msg.request)</span><br><span class="line">				c.tasks[msg.request.Id].status = Finished</span><br><span class="line">			&#125;</span><br><span class="line">			msg.ok &lt;- <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Worker-æ¨¡å—"><a href="#Worker-æ¨¡å—" class="headerlink" title="Worker æ¨¡å—"></a>Worker æ¨¡å—</h5><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åªæœ‰ doHeartbeat å¯èƒ½å¼•èµ·çŠ¶æ€çš„è½¬æ¢ï¼ŒdoReport æ˜¯ä¸€ä¸ªworker è¿›ç¨‹å®Œæˆäº†</span></span><br><span class="line">main/mrworker.<span class="keyword">go</span> calls mr/mrworker.<span class="keyword">go</span>/Worker()</span><br><span class="line">-&gt; Worker() é¦–å…ˆ doHeartbeat()</span><br><span class="line">æ‹¿åˆ° response := doHeartbeat() åï¼Œå°† response ä¼ ç»™ doMapTask/ doReduceTask</span><br><span class="line">-&gt; æ ¹æ®response.JobType å†³å®š doMapTask()/doReduceTask() ä¼š doReport()</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doHeartbeat</span><span class="params">()</span></span> *HeartbeatResponse &#123;</span><br><span class="line">	response := HeartbeatResponse&#123;&#125;</span><br><span class="line">	call(<span class="string">&quot;Coordinator.Heartbeat&quot;</span>, &amp;HeartbeatRequest&#123;&#125;, &amp;response)</span><br><span class="line">	<span class="keyword">return</span> &amp;response</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doReport</span><span class="params">(id <span class="type">int</span>, phase SchedulePhase)</span></span> &#123;</span><br><span class="line">	call(<span class="string">&quot;Coordinator.Report&quot;</span>, &amp;ReportRequest&#123;id, phase&#125;, &amp;ReportResponse&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Lab-2A-Rafté€‰ä¸¾"><a href="#Lab-2A-Rafté€‰ä¸¾" class="headerlink" title="Lab 2A: Rafté€‰ä¸¾"></a>Lab 2A: Rafté€‰ä¸¾</h3><p>A service calls <code>Make(peers,me,â€¦)</code> to create a Raft peer. The peers argument is an array of network identifiers of the Raft peers (including this one), for use with RPC. The <code>me</code> argument is the index of this peer in the peers array.</p>
<p>The service expects your implementation to send an <code>ApplyMsg</code> for each newly committed log entry to the <code>applyCh</code> channel argument to <code>Make()</code>.</p>
<p><code>raft.go</code> contains example code that sends an RPC (<code>sendRequestVote()</code>) and that handles an incoming RPC (<code>RequestVote()</code>). Your Raft peers should exchange RPCs using the labrpc Go package (source in <code>src/labrpc</code>). The tester can tell <code>labrpc</code> to delay RPCs, re-order them, and discard them to simulate various network failures. While you can temporarily modify <code>labrpc</code>, make sure your Raft works with the original <code>labrpc</code></p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span> ä¸€å¼€å§‹ï¼Œé›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯followerçŠ¶æ€ï¼Œterméƒ½ä¸º<span class="number">1</span>,å„èŠ‚ç‚¹ç»´æŠ¤è‡ªå·±çš„election_timeout</span><br><span class="line"><span class="number">2.</span> å¦‚æœåœ¨æŸèŠ‚ç‚¹election_timeoutåˆ°è¾¾æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°LeaderèŠ‚ç‚¹çš„å¿ƒè·³ï¼Œå°±ä¼šå‘èµ·æ–°ä¸€è½®çš„Leaderé€‰ä¸¾è¿‡ç¨‹</span><br><span class="line"><span class="number">3.</span> æ­¤æ—¶S2èŠ‚ç‚¹æœ€å…ˆè¶…æ—¶ï¼Œç°å°†è‡ªå·±term+<span class="number">1</span>å˜ä¸º<span class="number">2</span>, å°†è‡ªå·±çš„çŠ¶æ€åˆ‡æ¢ä¸ºCandidateçŠ¶æ€ï¼ŒæŠ•è‡ªå·±ä¸€ç¥¨ï¼Œå¹¶å‘å…¶ä½™æ‰€æœ‰èŠ‚ç‚¹å‘èµ·Request Vote RPCè¯·æ±‚</span><br><span class="line"><span class="number">4.</span> ç”±äºç›®å‰é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªCandidateï¼Œå› æ­¤å…¶ä½™èŠ‚ç‚¹éƒ½æŠ•äº†èµæˆç¥¨ï¼Œç„¶åå°†è‡ªå·±çš„terméƒ½+<span class="number">1</span>ä¿æŒä¸CandidateèŠ‚ç‚¹ä¸€è‡´çš„çŠ¶æ€</span><br><span class="line"><span class="number">5.</span> ç”±äºS2èŠ‚ç‚¹éƒ½åˆ°äº†è¶…è¿‡é›†ç¾¤æœºå™¨æ•°ä¸€åŠçš„ç¥¨æ•°ï¼Œå½“é€‰ä¸ºLeaderèŠ‚ç‚¹ï¼ŒçŠ¶æ€è½¬æ¢ä¸ºLeaderï¼ŒS2ç§°ä¸ºLeaderåä¼šä¸æ–­å‘å…¶ä»–èŠ‚ç‚¹å‘å¿ƒè·³</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/MIT6-824/" rel="tag"># MIT6.824</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/08/26/flutter/" rel="prev" title="flutter">
      <i class="fa fa-chevron-left"></i> flutter
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/09/26/Linux/" rel="next" title="Linux">
      Linux <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">æ–‡ä»¶ç»“æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lab-1-MapReduce"><span class="nav-number">2.</span> <span class="nav-text">Lab 1: MapReduce</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#A-few-rules"><span class="nav-number">2.1.</span> <span class="nav-text">A few rules:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hints"><span class="nav-number">2.2.</span> <span class="nav-text">Hints</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E2%80%BB%E6%B5%81%E7%A8%8B"><span class="nav-number">2.3.</span> <span class="nav-text">â€»æµç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Worker-%E6%A8%A1%E5%9D%97"><span class="nav-number">2.3.1.</span> <span class="nav-text">Worker æ¨¡å—</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lab-2A-Raft%E9%80%89%E4%B8%BE"><span class="nav-number">3.</span> <span class="nav-text">Lab 2A: Rafté€‰ä¸¾</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="kjg"
      src="/images/WechatIMG84.jpeg">
  <p class="site-author-name" itemprop="name">kjg</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">125</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">56</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/kjgggggg" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;kjgggggg" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/651373472@qq.com" title="E-Mail â†’ 651373472@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
</div>

<span style="text-align:center;display:block;">
<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span <div>wmr</div> </span>
</span>

        
<span style="text-align:center;display:block;">
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        æœ¬ç«™æ€»è®¿é—®äººæ•°ï¼š
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider"></span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        æœ¬ç«™æ€»è®¿é—®é‡ï¼š 
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
</span>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  
<script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '16px',
  right: '28px',
  left: 'unset',
  time: '0.3s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: 'ğŸŒ“',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>

</body>
</html>
